# Requirements Archive: v1.1 Codebase Improvements

**Archived:** 2026-01-23
**Status:** ✅ SHIPPED
**Scope:** All v1.1 requirements shipped

This is the archived requirements specification for v1.1 "Codebase Improvements".
For current requirements (next milestone), see `.planning/REQUIREMENTS.md`.

---

# Requirements: NBU Exporter v1.1

**Defined:** 2026-01-23
**Core Value:** Improve code reliability and maintainability by fixing identified concerns

## v1.1 Requirements

Requirements for codebase improvements milestone. Each maps to roadmap phases.

### Known Bugs

- [x] **BUG-01**: Fix version detection state restoration on context cancellation ✓ (Phase 1)

### Security

- [x] **SEC-01**: Implement secure API key handling in memory ✓ (Phase 2)
- [x] **SEC-02**: Enforce TLS verification by default with explicit opt-out ✓ (Phase 2)
- [x] **SEC-03**: Add rate limiting and backoff for metric collection ✓ (Phase 2)

### Tech Debt

- [x] **TD-01**: Fix configuration mutation during version detection (immutable config pattern) ✓ (Phase 3)
- [x] **TD-02**: Eliminate global OpenTelemetry state (dependency injection) ✓ (Phase 3)
- [x] **TD-03**: Replace pipe-delimited metric keys with structured format ✓ (Phase 3)
- [x] **TD-04**: Add test coverage for main.go entry point ✓ (Phase 4)
- [x] **TD-05**: Implement proper resource cleanup in NbuClient.Close() ✓ (Phase 1)
- [x] **TD-06**: Replace fatal log in async goroutine with error channel ✓ (Phase 1)

### Fragile Areas

- [x] **FRAG-01**: Remove shared config reference from APIVersionDetector ✓ (Phase 1)
- [x] **FRAG-02**: Add connection pool lifecycle management ✓ (Phase 3)
- [x] **FRAG-03**: Handle URL parsing errors in BuildURL ✓ (Phase 1)
- [x] **FRAG-04**: Centralize tracer nil-checks into wrapper method ✓ (Phase 3)

### Test Coverage

- [x] **TEST-01**: Add integration tests for main.go (0% → 60%+) ✓ (Phase 4)
- [x] **TEST-02**: Increase testutil coverage (51.9% → 97.5%) ✓ (Phase 4)
- [x] **TEST-03**: Increase telemetry coverage (76.6% → 83.7%) ✓ (Phase 4)
- [x] **TEST-04**: Add concurrent collector access tests ✓ (Phase 4)
- [x] **TEST-05**: Add client error handling edge case tests ✓ (Phase 4)

### Performance

- [x] **PERF-01**: Increase pagination page size for job fetching ✓ (Phase 5)
- [x] **PERF-02**: Parallelize storage and job metric collection ✓ (Phase 5)
- [x] **PERF-03**: Pre-allocate maps/slices for memory efficiency ✓ (Phase 5)
- [x] **PERF-04**: Structured keys eliminate split operations (completed in TD-03) ✓ (Phase 3)

### Missing Features

- [x] **FEAT-01**: Add caching for storage metrics ✓ (Phase 6)
- [x] **FEAT-02**: Implement health check with NetBackup connectivity verification ✓ (Phase 6)
- [x] **FEAT-03**: Add metric staleness tracking ✓ (Phase 6)
- [x] **FEAT-04**: Implement dynamic configuration reload ✓ (Phase 6)

## Future Requirements

Deferred to future milestones. Not in current roadmap.

### Scaling

- **SCALE-01**: Multi-collector framework for multiple NBU servers
- **SCALE-02**: Time-based job sharding for large environments

## Out of Scope

Explicitly excluded. Documented to prevent scope creep.

| Feature                     | Reason                                           |
| --------------------------- | ------------------------------------------------ |
| Certificate pinning         | TLS verification improvements sufficient for now |
| Mobile/web dashboard        | Not core exporter functionality                  |
| Real-time streaming metrics | Would require architectural changes              |

## Traceability

Which phases cover which requirements. Final status for v1.1.

| Requirement | Phase   | Status   |
| ----------- | ------- | -------- |
| BUG-01      | Phase 1 | Complete |
| SEC-01      | Phase 2 | Complete |
| SEC-02      | Phase 2 | Complete |
| SEC-03      | Phase 2 | Complete |
| TD-01       | Phase 3 | Complete |
| TD-02       | Phase 3 | Complete |
| TD-03       | Phase 3 | Complete |
| TD-04       | Phase 4 | Complete |
| TD-05       | Phase 1 | Complete |
| TD-06       | Phase 1 | Complete |
| FRAG-01     | Phase 1 | Complete |
| FRAG-02     | Phase 3 | Complete |
| FRAG-03     | Phase 1 | Complete |
| FRAG-04     | Phase 3 | Complete |
| TEST-01     | Phase 4 | Complete |
| TEST-02     | Phase 4 | Complete |
| TEST-03     | Phase 4 | Complete |
| TEST-04     | Phase 4 | Complete |
| TEST-05     | Phase 4 | Complete |
| PERF-01     | Phase 5 | Complete |
| PERF-02     | Phase 5 | Complete |
| PERF-03     | Phase 5 | Complete |
| PERF-04     | Phase 3 | Complete |
| FEAT-01     | Phase 6 | Complete |
| FEAT-02     | Phase 6 | Complete |
| FEAT-03     | Phase 6 | Complete |
| FEAT-04     | Phase 6 | Complete |

**Coverage:**

- v1.1 requirements: 27 total
- All shipped: 27
- Coverage: 100%

---

## Milestone Summary

**Shipped:** 27 of 27 v1.1 requirements ✅

**Requirements delivered on schedule:**
- Phase 1: 5 requirements (Bugs + Tech Debt + Fragile Areas)
- Phase 2: 3 requirements (Security hardening)
- Phase 3: 5 requirements (Tech Debt + Architecture + Fragile Areas)
- Phase 4: 6 requirements (Test Coverage)
- Phase 5: 4 requirements (Performance)
- Phase 6: 4 requirements (Operational Features)

**No adjustments:** Requirements remained stable throughout milestone execution. No scope changes or drops.

**Key metrics:**
- 21 plans executed across 6 phases
- 99 files modified
- 5,013 insertions, 635 deletions
- 21 hours of work compressed into 1.5-hour execution window (thorough planning)

---

_Archived: 2026-01-23 as part of v1.1 milestone completion_
