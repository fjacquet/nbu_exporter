
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Prometheus exporter for Veritas NetBackup">
      
      
      
        <link rel="canonical" href="https://fjacquet.github.io/nbu_exporter/deployment-verification/">
      
      
        <link rel="prev" href="../api-10.5-migration/">
      
      
        <link rel="next" href="../deployment-quick-reference/">
      
      
        
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.1">
    
    
      
        <title>Verification - NBU Exporter</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.484c7ddc.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#deployment-verification-and-rollback-procedures" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="NBU Exporter" class="md-header__button md-logo" aria-label="NBU Exporter" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            NBU Exporter
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Verification
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/fjacquet/nbu_exporter" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    fjacquet/nbu_exporter
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="NBU Exporter" class="md-nav__button md-logo" aria-label="NBU Exporter" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    NBU Exporter
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/fjacquet/nbu_exporter" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    fjacquet/nbu_exporter
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Home
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    Getting Started
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Getting Started
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../getting-started/installation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Installation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../getting-started/configuration/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Configuration
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../getting-started/quickstart/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Quick Start
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../metrics/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Metrics Reference
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    OpenTelemetry Integration
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    OpenTelemetry Integration
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../opentelemetry-example/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Setup Guide
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../trace-analysis-guide/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Trace Analysis
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    Migration Guides
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    Migration Guides
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../netbackup-11-migration/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    NetBackup 11.0
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../api-10.5-migration/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    API 10.5
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" checked>
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    Deployment
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            
  
    Deployment
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    Verification
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    Verification
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#overview" class="md-nav__link">
    <span class="md-ellipsis">
      
        Overview
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pre-deployment-checklist" class="md-nav__link">
    <span class="md-ellipsis">
      
        Pre-Deployment Checklist
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Pre-Deployment Checklist">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#environment-requirements" class="md-nav__link">
    <span class="md-ellipsis">
      
        Environment Requirements
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#verification-commands" class="md-nav__link">
    <span class="md-ellipsis">
      
        Verification Commands
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deployment-procedures" class="md-nav__link">
    <span class="md-ellipsis">
      
        Deployment Procedures
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Deployment Procedures">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#method-1-binary-upgrade-recommended" class="md-nav__link">
    <span class="md-ellipsis">
      
        Method 1: Binary Upgrade (Recommended)
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Method 1: Binary Upgrade (Recommended)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#step-1-backup-current-setup" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 1: Backup Current Setup
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-2-stop-current-exporter" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 2: Stop Current Exporter
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-3-update-binary" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 3: Update Binary
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-4-update-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 4: Update Configuration
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-5-validate-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 5: Validate Configuration
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-6-start-exporter" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 6: Start Exporter
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#method-2-docker-deployment" class="md-nav__link">
    <span class="md-ellipsis">
      
        Method 2: Docker Deployment
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Method 2: Docker Deployment">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#step-1-backup-and-stop" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 1: Backup and Stop
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-2-update-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 2: Update Configuration
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-3-pull-new-image-and-start" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 3: Pull New Image and Start
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#verification-procedures" class="md-nav__link">
    <span class="md-ellipsis">
      
        Verification Procedures
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Verification Procedures">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#level-1-basic-health-check" class="md-nav__link">
    <span class="md-ellipsis">
      
        Level 1: Basic Health Check
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#level-2-metrics-availability" class="md-nav__link">
    <span class="md-ellipsis">
      
        Level 2: Metrics Availability
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#level-3-api-communication" class="md-nav__link">
    <span class="md-ellipsis">
      
        Level 3: API Communication
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#level-4-data-validation" class="md-nav__link">
    <span class="md-ellipsis">
      
        Level 4: Data Validation
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#level-5-prometheus-integration" class="md-nav__link">
    <span class="md-ellipsis">
      
        Level 5: Prometheus Integration
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#level-6-grafana-dashboard" class="md-nav__link">
    <span class="md-ellipsis">
      
        Level 6: Grafana Dashboard
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#backward-compatibility-verification" class="md-nav__link">
    <span class="md-ellipsis">
      
        Backward Compatibility Verification
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Backward Compatibility Verification">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#test-1-configuration-without-api-version" class="md-nav__link">
    <span class="md-ellipsis">
      
        Test 1: Configuration Without API Version
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test-2-legacy-configuration-structure" class="md-nav__link">
    <span class="md-ellipsis">
      
        Test 2: Legacy Configuration Structure
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test-3-metrics-consistency" class="md-nav__link">
    <span class="md-ellipsis">
      
        Test 3: Metrics Consistency
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#rollback-procedures" class="md-nav__link">
    <span class="md-ellipsis">
      
        Rollback Procedures
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Rollback Procedures">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#when-to-rollback" class="md-nav__link">
    <span class="md-ellipsis">
      
        When to Rollback
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#quick-rollback-5-minutes" class="md-nav__link">
    <span class="md-ellipsis">
      
        Quick Rollback (&lt; 5 minutes)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#detailed-rollback-steps" class="md-nav__link">
    <span class="md-ellipsis">
      
        Detailed Rollback Steps
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Detailed Rollback Steps">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#step-1-stop-new-version" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 1: Stop New Version
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-2-restore-previous-binary" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 2: Restore Previous Binary
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-3-restore-previous-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 3: Restore Previous Configuration
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-4-restart-service" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 4: Restart Service
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-5-verify-rollback-success" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 5: Verify Rollback Success
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-6-document-rollback-reason" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 6: Document Rollback Reason
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#breaking-changes-verification" class="md-nav__link">
    <span class="md-ellipsis">
      
        Breaking Changes Verification
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Breaking Changes Verification">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#verification-test-suite" class="md-nav__link">
    <span class="md-ellipsis">
      
        Verification Test Suite
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#post-deployment-monitoring" class="md-nav__link">
    <span class="md-ellipsis">
      
        Post-Deployment Monitoring
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Post-Deployment Monitoring">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#first-24-hours" class="md-nav__link">
    <span class="md-ellipsis">
      
        First 24 Hours
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alerting-rules" class="md-nav__link">
    <span class="md-ellipsis">
      
        Alerting Rules
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#performance-baseline" class="md-nav__link">
    <span class="md-ellipsis">
      
        Performance Baseline
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#troubleshooting-deployment-issues" class="md-nav__link">
    <span class="md-ellipsis">
      
        Troubleshooting Deployment Issues
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Troubleshooting Deployment Issues">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#issue-exporter-wont-start" class="md-nav__link">
    <span class="md-ellipsis">
      
        Issue: Exporter Won't Start
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#issue-api-version-errors" class="md-nav__link">
    <span class="md-ellipsis">
      
        Issue: API Version Errors
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#issue-metrics-not-updating" class="md-nav__link">
    <span class="md-ellipsis">
      
        Issue: Metrics Not Updating
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deployment-checklist" class="md-nav__link">
    <span class="md-ellipsis">
      
        Deployment Checklist
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Deployment Checklist">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pre-deployment" class="md-nav__link">
    <span class="md-ellipsis">
      
        Pre-Deployment
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deployment" class="md-nav__link">
    <span class="md-ellipsis">
      
        Deployment
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#post-deployment" class="md-nav__link">
    <span class="md-ellipsis">
      
        Post-Deployment
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rollback-if-needed" class="md-nav__link">
    <span class="md-ellipsis">
      
        Rollback (If Needed)
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#automation-scripts" class="md-nav__link">
    <span class="md-ellipsis">
      
        Automation Scripts
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Automation Scripts">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#deployment-script" class="md-nav__link">
    <span class="md-ellipsis">
      
        Deployment Script
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rollback-script" class="md-nav__link">
    <span class="md-ellipsis">
      
        Rollback Script
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#summary" class="md-nav__link">
    <span class="md-ellipsis">
      
        Summary
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Summary">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#key-takeaways" class="md-nav__link">
    <span class="md-ellipsis">
      
        Key Takeaways
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#support" class="md-nav__link">
    <span class="md-ellipsis">
      
        Support
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#related-documentation" class="md-nav__link">
    <span class="md-ellipsis">
      
        Related Documentation
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../deployment-quick-reference/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Quick Reference
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../docker/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Docker
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../config-examples/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Configuration Examples
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../changelog/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Changelog
  

    
  </span>
  
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#overview" class="md-nav__link">
    <span class="md-ellipsis">
      
        Overview
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pre-deployment-checklist" class="md-nav__link">
    <span class="md-ellipsis">
      
        Pre-Deployment Checklist
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Pre-Deployment Checklist">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#environment-requirements" class="md-nav__link">
    <span class="md-ellipsis">
      
        Environment Requirements
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#verification-commands" class="md-nav__link">
    <span class="md-ellipsis">
      
        Verification Commands
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deployment-procedures" class="md-nav__link">
    <span class="md-ellipsis">
      
        Deployment Procedures
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Deployment Procedures">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#method-1-binary-upgrade-recommended" class="md-nav__link">
    <span class="md-ellipsis">
      
        Method 1: Binary Upgrade (Recommended)
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Method 1: Binary Upgrade (Recommended)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#step-1-backup-current-setup" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 1: Backup Current Setup
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-2-stop-current-exporter" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 2: Stop Current Exporter
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-3-update-binary" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 3: Update Binary
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-4-update-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 4: Update Configuration
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-5-validate-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 5: Validate Configuration
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-6-start-exporter" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 6: Start Exporter
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#method-2-docker-deployment" class="md-nav__link">
    <span class="md-ellipsis">
      
        Method 2: Docker Deployment
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Method 2: Docker Deployment">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#step-1-backup-and-stop" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 1: Backup and Stop
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-2-update-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 2: Update Configuration
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-3-pull-new-image-and-start" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 3: Pull New Image and Start
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#verification-procedures" class="md-nav__link">
    <span class="md-ellipsis">
      
        Verification Procedures
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Verification Procedures">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#level-1-basic-health-check" class="md-nav__link">
    <span class="md-ellipsis">
      
        Level 1: Basic Health Check
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#level-2-metrics-availability" class="md-nav__link">
    <span class="md-ellipsis">
      
        Level 2: Metrics Availability
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#level-3-api-communication" class="md-nav__link">
    <span class="md-ellipsis">
      
        Level 3: API Communication
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#level-4-data-validation" class="md-nav__link">
    <span class="md-ellipsis">
      
        Level 4: Data Validation
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#level-5-prometheus-integration" class="md-nav__link">
    <span class="md-ellipsis">
      
        Level 5: Prometheus Integration
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#level-6-grafana-dashboard" class="md-nav__link">
    <span class="md-ellipsis">
      
        Level 6: Grafana Dashboard
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#backward-compatibility-verification" class="md-nav__link">
    <span class="md-ellipsis">
      
        Backward Compatibility Verification
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Backward Compatibility Verification">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#test-1-configuration-without-api-version" class="md-nav__link">
    <span class="md-ellipsis">
      
        Test 1: Configuration Without API Version
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test-2-legacy-configuration-structure" class="md-nav__link">
    <span class="md-ellipsis">
      
        Test 2: Legacy Configuration Structure
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test-3-metrics-consistency" class="md-nav__link">
    <span class="md-ellipsis">
      
        Test 3: Metrics Consistency
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#rollback-procedures" class="md-nav__link">
    <span class="md-ellipsis">
      
        Rollback Procedures
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Rollback Procedures">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#when-to-rollback" class="md-nav__link">
    <span class="md-ellipsis">
      
        When to Rollback
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#quick-rollback-5-minutes" class="md-nav__link">
    <span class="md-ellipsis">
      
        Quick Rollback (&lt; 5 minutes)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#detailed-rollback-steps" class="md-nav__link">
    <span class="md-ellipsis">
      
        Detailed Rollback Steps
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Detailed Rollback Steps">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#step-1-stop-new-version" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 1: Stop New Version
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-2-restore-previous-binary" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 2: Restore Previous Binary
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-3-restore-previous-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 3: Restore Previous Configuration
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-4-restart-service" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 4: Restart Service
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-5-verify-rollback-success" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 5: Verify Rollback Success
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-6-document-rollback-reason" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 6: Document Rollback Reason
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#breaking-changes-verification" class="md-nav__link">
    <span class="md-ellipsis">
      
        Breaking Changes Verification
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Breaking Changes Verification">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#verification-test-suite" class="md-nav__link">
    <span class="md-ellipsis">
      
        Verification Test Suite
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#post-deployment-monitoring" class="md-nav__link">
    <span class="md-ellipsis">
      
        Post-Deployment Monitoring
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Post-Deployment Monitoring">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#first-24-hours" class="md-nav__link">
    <span class="md-ellipsis">
      
        First 24 Hours
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alerting-rules" class="md-nav__link">
    <span class="md-ellipsis">
      
        Alerting Rules
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#performance-baseline" class="md-nav__link">
    <span class="md-ellipsis">
      
        Performance Baseline
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#troubleshooting-deployment-issues" class="md-nav__link">
    <span class="md-ellipsis">
      
        Troubleshooting Deployment Issues
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Troubleshooting Deployment Issues">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#issue-exporter-wont-start" class="md-nav__link">
    <span class="md-ellipsis">
      
        Issue: Exporter Won't Start
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#issue-api-version-errors" class="md-nav__link">
    <span class="md-ellipsis">
      
        Issue: API Version Errors
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#issue-metrics-not-updating" class="md-nav__link">
    <span class="md-ellipsis">
      
        Issue: Metrics Not Updating
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deployment-checklist" class="md-nav__link">
    <span class="md-ellipsis">
      
        Deployment Checklist
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Deployment Checklist">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pre-deployment" class="md-nav__link">
    <span class="md-ellipsis">
      
        Pre-Deployment
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deployment" class="md-nav__link">
    <span class="md-ellipsis">
      
        Deployment
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#post-deployment" class="md-nav__link">
    <span class="md-ellipsis">
      
        Post-Deployment
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rollback-if-needed" class="md-nav__link">
    <span class="md-ellipsis">
      
        Rollback (If Needed)
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#automation-scripts" class="md-nav__link">
    <span class="md-ellipsis">
      
        Automation Scripts
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Automation Scripts">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#deployment-script" class="md-nav__link">
    <span class="md-ellipsis">
      
        Deployment Script
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rollback-script" class="md-nav__link">
    <span class="md-ellipsis">
      
        Rollback Script
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#summary" class="md-nav__link">
    <span class="md-ellipsis">
      
        Summary
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Summary">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#key-takeaways" class="md-nav__link">
    <span class="md-ellipsis">
      
        Key Takeaways
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#support" class="md-nav__link">
    <span class="md-ellipsis">
      
        Support
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#related-documentation" class="md-nav__link">
    <span class="md-ellipsis">
      
        Related Documentation
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="deployment-verification-and-rollback-procedures">Deployment Verification and Rollback Procedures</h1>
<h2 id="overview">Overview</h2>
<p>This document provides comprehensive procedures for deploying the NBU Exporter with NetBackup API 10.5 support, verifying the deployment, and rolling back if issues occur.</p>
<h2 id="pre-deployment-checklist">Pre-Deployment Checklist</h2>
<h3 id="environment-requirements">Environment Requirements</h3>
<ul>
<li>[ ] NetBackup Server version 10.5 or later installed</li>
<li>[ ] Valid NetBackup API key with required permissions</li>
<li>[ ] Network connectivity from exporter host to NetBackup master server (port 1556)</li>
<li>[ ] Prometheus instance configured to scrape the exporter</li>
<li>[ ] Backup of current configuration and binary</li>
</ul>
<h3 id="verification-commands">Verification Commands</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="c1"># Check NetBackup version</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>ssh<span class="w"> </span>netbackup-master<span class="w"> </span><span class="s2">&quot;bpgetconfig -g | grep VERSION&quot;</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="c1"># Test API connectivity</span>
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>curl<span class="w"> </span>-k<span class="w"> </span>-H<span class="w"> </span><span class="s2">&quot;Authorization: YOUR_API_KEY&quot;</span><span class="w"> </span><span class="se">\</span>
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a><span class="w">  </span>https://netbackup-master:1556/netbackup/config/servers/master
<a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a>
<a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a><span class="c1"># Verify current exporter is running</span>
<a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a>ps<span class="w"> </span>aux<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>nbu_exporter
<a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a>curl<span class="w"> </span>http://localhost:2112/health
</code></pre></div>
<h2 id="deployment-procedures">Deployment Procedures</h2>
<h3 id="method-1-binary-upgrade-recommended">Method 1: Binary Upgrade (Recommended)</h3>
<h4 id="step-1-backup-current-setup">Step 1: Backup Current Setup</h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="c1"># Create backup directory</span>
<a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a>mkdir<span class="w"> </span>-p<span class="w"> </span>backups/<span class="k">$(</span>date<span class="w"> </span>+%Y%m%d<span class="k">)</span>
<a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a>
<a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a><span class="c1"># Backup configuration</span>
<a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a>cp<span class="w"> </span>config.yaml<span class="w"> </span>backups/<span class="k">$(</span>date<span class="w"> </span>+%Y%m%d<span class="k">)</span>/config.yaml.backup
<a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a>
<a id="__codelineno-1-7" name="__codelineno-1-7" href="#__codelineno-1-7"></a><span class="c1"># Backup binary</span>
<a id="__codelineno-1-8" name="__codelineno-1-8" href="#__codelineno-1-8"></a>cp<span class="w"> </span>bin/nbu_exporter<span class="w"> </span>backups/<span class="k">$(</span>date<span class="w"> </span>+%Y%m%d<span class="k">)</span>/nbu_exporter.backup
<a id="__codelineno-1-9" name="__codelineno-1-9" href="#__codelineno-1-9"></a>
<a id="__codelineno-1-10" name="__codelineno-1-10" href="#__codelineno-1-10"></a><span class="c1"># Backup logs (optional)</span>
<a id="__codelineno-1-11" name="__codelineno-1-11" href="#__codelineno-1-11"></a>cp<span class="w"> </span>-r<span class="w"> </span>log<span class="w"> </span>backups/<span class="k">$(</span>date<span class="w"> </span>+%Y%m%d<span class="k">)</span>/log.backup
</code></pre></div>
<h4 id="step-2-stop-current-exporter">Step 2: Stop Current Exporter</h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="c1"># If running as systemd service</span>
<a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a>sudo<span class="w"> </span>systemctl<span class="w"> </span>stop<span class="w"> </span>nbu_exporter
<a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a>sudo<span class="w"> </span>systemctl<span class="w"> </span>status<span class="w"> </span>nbu_exporter<span class="w">  </span><span class="c1"># Verify stopped</span>
<a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a>
<a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a><span class="c1"># If running in Docker</span>
<a id="__codelineno-2-6" name="__codelineno-2-6" href="#__codelineno-2-6"></a>docker<span class="w"> </span>stop<span class="w"> </span>nbu_exporter
<a id="__codelineno-2-7" name="__codelineno-2-7" href="#__codelineno-2-7"></a>docker<span class="w"> </span>ps<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>nbu_exporter<span class="w">  </span><span class="c1"># Verify stopped</span>
<a id="__codelineno-2-8" name="__codelineno-2-8" href="#__codelineno-2-8"></a>
<a id="__codelineno-2-9" name="__codelineno-2-9" href="#__codelineno-2-9"></a><span class="c1"># If running manually</span>
<a id="__codelineno-2-10" name="__codelineno-2-10" href="#__codelineno-2-10"></a>pkill<span class="w"> </span>-TERM<span class="w"> </span>nbu_exporter
<a id="__codelineno-2-11" name="__codelineno-2-11" href="#__codelineno-2-11"></a><span class="c1"># Wait 10 seconds for graceful shutdown</span>
<a id="__codelineno-2-12" name="__codelineno-2-12" href="#__codelineno-2-12"></a>sleep<span class="w"> </span><span class="m">10</span>
<a id="__codelineno-2-13" name="__codelineno-2-13" href="#__codelineno-2-13"></a>ps<span class="w"> </span>aux<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>nbu_exporter<span class="w">  </span><span class="c1"># Verify stopped</span>
</code></pre></div>
<h4 id="step-3-update-binary">Step 3: Update Binary</h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="c1"># Option A: Download pre-built binary</span>
<a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a>wget<span class="w"> </span>https://github.com/fjacquet/nbu_exporter/releases/download/v2.0.0/nbu_exporter-linux-amd64
<a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a>chmod<span class="w"> </span>+x<span class="w"> </span>nbu_exporter-linux-amd64
<a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a>mv<span class="w"> </span>nbu_exporter-linux-amd64<span class="w"> </span>bin/nbu_exporter
<a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a>
<a id="__codelineno-3-6" name="__codelineno-3-6" href="#__codelineno-3-6"></a><span class="c1"># Option B: Build from source</span>
<a id="__codelineno-3-7" name="__codelineno-3-7" href="#__codelineno-3-7"></a>git<span class="w"> </span>pull<span class="w"> </span>origin<span class="w"> </span>main
<a id="__codelineno-3-8" name="__codelineno-3-8" href="#__codelineno-3-8"></a>make<span class="w"> </span>cli
<a id="__codelineno-3-9" name="__codelineno-3-9" href="#__codelineno-3-9"></a><span class="c1"># Binary will be in bin/nbu_exporter</span>
</code></pre></div>
<h4 id="step-4-update-configuration">Step 4: Update Configuration</h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="c1"># Edit config.yaml to add API version</span>
<a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a>cat<span class="w"> </span>&gt;&gt;<span class="w"> </span>config.yaml<span class="w"> </span><span class="s">&lt;&lt; &#39;EOF&#39;</span>
<a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a><span class="s"># Add under nbuserver section:</span>
<a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a><span class="s">    apiVersion: &quot;12.0&quot;  # NetBackup API version for 10.5+</span>
<a id="__codelineno-4-5" name="__codelineno-4-5" href="#__codelineno-4-5"></a><span class="s">EOF</span>
<a id="__codelineno-4-6" name="__codelineno-4-6" href="#__codelineno-4-6"></a>
<a id="__codelineno-4-7" name="__codelineno-4-7" href="#__codelineno-4-7"></a><span class="c1"># Or use sed to add it programmatically</span>
<a id="__codelineno-4-8" name="__codelineno-4-8" href="#__codelineno-4-8"></a>sed<span class="w"> </span>-i<span class="w"> </span><span class="s1">&#39;/nbuserver:/a\    apiVersion: &quot;12.0&quot;&#39;</span><span class="w"> </span>config.yaml
</code></pre></div>
<h4 id="step-5-validate-configuration">Step 5: Validate Configuration</h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="c1"># Test configuration with debug mode (don&#39;t start service yet)</span>
<a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a>./bin/nbu_exporter<span class="w"> </span>--config<span class="w"> </span>config.yaml<span class="w"> </span>--debug<span class="w"> </span><span class="p">&amp;</span>
<a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a><span class="nv">EXPORTER_PID</span><span class="o">=</span><span class="nv">$!</span>
<a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a>
<a id="__codelineno-5-5" name="__codelineno-5-5" href="#__codelineno-5-5"></a><span class="c1"># Wait for startup</span>
<a id="__codelineno-5-6" name="__codelineno-5-6" href="#__codelineno-5-6"></a>sleep<span class="w"> </span><span class="m">5</span>
<a id="__codelineno-5-7" name="__codelineno-5-7" href="#__codelineno-5-7"></a>
<a id="__codelineno-5-8" name="__codelineno-5-8" href="#__codelineno-5-8"></a><span class="c1"># Check logs for successful initialization</span>
<a id="__codelineno-5-9" name="__codelineno-5-9" href="#__codelineno-5-9"></a>tail<span class="w"> </span>-20<span class="w"> </span>log/nbu-exporter.log<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>-E<span class="w"> </span><span class="s2">&quot;Using NetBackup API version|Successfully&quot;</span>
<a id="__codelineno-5-10" name="__codelineno-5-10" href="#__codelineno-5-10"></a>
<a id="__codelineno-5-11" name="__codelineno-5-11" href="#__codelineno-5-11"></a><span class="c1"># Stop test instance</span>
<a id="__codelineno-5-12" name="__codelineno-5-12" href="#__codelineno-5-12"></a><span class="nb">kill</span><span class="w"> </span>-TERM<span class="w"> </span><span class="nv">$EXPORTER_PID</span>
</code></pre></div>
<h4 id="step-6-start-exporter">Step 6: Start Exporter</h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="c1"># If running as systemd service</span>
<a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a>sudo<span class="w"> </span>systemctl<span class="w"> </span>start<span class="w"> </span>nbu_exporter
<a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a>sudo<span class="w"> </span>systemctl<span class="w"> </span>status<span class="w"> </span>nbu_exporter
<a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a>
<a id="__codelineno-6-5" name="__codelineno-6-5" href="#__codelineno-6-5"></a><span class="c1"># If running in Docker</span>
<a id="__codelineno-6-6" name="__codelineno-6-6" href="#__codelineno-6-6"></a>docker<span class="w"> </span>start<span class="w"> </span>nbu_exporter
<a id="__codelineno-6-7" name="__codelineno-6-7" href="#__codelineno-6-7"></a>docker<span class="w"> </span>logs<span class="w"> </span>-f<span class="w"> </span>nbu_exporter
<a id="__codelineno-6-8" name="__codelineno-6-8" href="#__codelineno-6-8"></a>
<a id="__codelineno-6-9" name="__codelineno-6-9" href="#__codelineno-6-9"></a><span class="c1"># If running manually</span>
<a id="__codelineno-6-10" name="__codelineno-6-10" href="#__codelineno-6-10"></a>nohup<span class="w"> </span>./bin/nbu_exporter<span class="w"> </span>--config<span class="w"> </span>config.yaml<span class="w"> </span>&gt;<span class="w"> </span>/dev/null<span class="w"> </span><span class="m">2</span>&gt;<span class="p">&amp;</span><span class="m">1</span><span class="w"> </span><span class="p">&amp;</span>
<a id="__codelineno-6-11" name="__codelineno-6-11" href="#__codelineno-6-11"></a><span class="nb">echo</span><span class="w"> </span><span class="nv">$!</span><span class="w"> </span>&gt;<span class="w"> </span>nbu_exporter.pid
</code></pre></div>
<h3 id="method-2-docker-deployment">Method 2: Docker Deployment</h3>
<h4 id="step-1-backup-and-stop">Step 1: Backup and Stop</h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="c1"># Backup configuration</span>
<a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a>docker<span class="w"> </span>cp<span class="w"> </span>nbu_exporter:/config.yaml<span class="w"> </span>config.yaml.backup
<a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a>
<a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a><span class="c1"># Stop and remove container</span>
<a id="__codelineno-7-5" name="__codelineno-7-5" href="#__codelineno-7-5"></a>docker<span class="w"> </span>stop<span class="w"> </span>nbu_exporter
<a id="__codelineno-7-6" name="__codelineno-7-6" href="#__codelineno-7-6"></a>docker<span class="w"> </span>rm<span class="w"> </span>nbu_exporter
</code></pre></div>
<h4 id="step-2-update-configuration">Step 2: Update Configuration</h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a><span class="c1"># Edit local config.yaml to add apiVersion</span>
<a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a>vi<span class="w"> </span>config.yaml
<a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a><span class="c1"># Add: apiVersion: &quot;12.0&quot; under nbuserver section</span>
</code></pre></div>
<h4 id="step-3-pull-new-image-and-start">Step 3: Pull New Image and Start</h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a><span class="c1"># Pull latest image</span>
<a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a>docker<span class="w"> </span>pull<span class="w"> </span>fjacquet/nbu_exporter:latest
<a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a>
<a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a><span class="c1"># Start new container</span>
<a id="__codelineno-9-5" name="__codelineno-9-5" href="#__codelineno-9-5"></a>docker<span class="w"> </span>run<span class="w"> </span>-d<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-9-6" name="__codelineno-9-6" href="#__codelineno-9-6"></a><span class="w">  </span>--name<span class="w"> </span>nbu_exporter<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-9-7" name="__codelineno-9-7" href="#__codelineno-9-7"></a><span class="w">  </span>-p<span class="w"> </span><span class="m">2112</span>:2112<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-9-8" name="__codelineno-9-8" href="#__codelineno-9-8"></a><span class="w">  </span>-v<span class="w"> </span><span class="k">$(</span><span class="nb">pwd</span><span class="k">)</span>/config.yaml:/config.yaml<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-9-9" name="__codelineno-9-9" href="#__codelineno-9-9"></a><span class="w">  </span>--restart<span class="w"> </span>unless-stopped<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-9-10" name="__codelineno-9-10" href="#__codelineno-9-10"></a><span class="w">  </span>fjacquet/nbu_exporter:latest<span class="w"> </span>--config<span class="w"> </span>/config.yaml
<a id="__codelineno-9-11" name="__codelineno-9-11" href="#__codelineno-9-11"></a>
<a id="__codelineno-9-12" name="__codelineno-9-12" href="#__codelineno-9-12"></a><span class="c1"># Check logs</span>
<a id="__codelineno-9-13" name="__codelineno-9-13" href="#__codelineno-9-13"></a>docker<span class="w"> </span>logs<span class="w"> </span>-f<span class="w"> </span>nbu_exporter
</code></pre></div>
<h2 id="verification-procedures">Verification Procedures</h2>
<h3 id="level-1-basic-health-check">Level 1: Basic Health Check</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a><span class="c1"># Check process is running</span>
<a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a>ps<span class="w"> </span>aux<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>nbu_exporter
<a id="__codelineno-10-3" name="__codelineno-10-3" href="#__codelineno-10-3"></a><span class="c1"># Or for Docker</span>
<a id="__codelineno-10-4" name="__codelineno-10-4" href="#__codelineno-10-4"></a>docker<span class="w"> </span>ps<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>nbu_exporter
<a id="__codelineno-10-5" name="__codelineno-10-5" href="#__codelineno-10-5"></a>
<a id="__codelineno-10-6" name="__codelineno-10-6" href="#__codelineno-10-6"></a><span class="c1"># Check health endpoint</span>
<a id="__codelineno-10-7" name="__codelineno-10-7" href="#__codelineno-10-7"></a>curl<span class="w"> </span>http://localhost:2112/health
<a id="__codelineno-10-8" name="__codelineno-10-8" href="#__codelineno-10-8"></a><span class="c1"># Expected: {&quot;status&quot;:&quot;healthy&quot;}</span>
</code></pre></div>
<h3 id="level-2-metrics-availability">Level 2: Metrics Availability</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a><span class="c1"># Check metrics endpoint responds</span>
<a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a>curl<span class="w"> </span>-s<span class="w"> </span>http://localhost:2112/metrics<span class="w"> </span><span class="p">|</span><span class="w"> </span>head<span class="w"> </span>-20
<a id="__codelineno-11-3" name="__codelineno-11-3" href="#__codelineno-11-3"></a>
<a id="__codelineno-11-4" name="__codelineno-11-4" href="#__codelineno-11-4"></a><span class="c1"># Verify NBU-specific metrics are present</span>
<a id="__codelineno-11-5" name="__codelineno-11-5" href="#__codelineno-11-5"></a>curl<span class="w"> </span>-s<span class="w"> </span>http://localhost:2112/metrics<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>-E<span class="w"> </span><span class="s2">&quot;^nbu_&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>head<span class="w"> </span>-10
<a id="__codelineno-11-6" name="__codelineno-11-6" href="#__codelineno-11-6"></a>
<a id="__codelineno-11-7" name="__codelineno-11-7" href="#__codelineno-11-7"></a><span class="c1"># Expected metrics:</span>
<a id="__codelineno-11-8" name="__codelineno-11-8" href="#__codelineno-11-8"></a><span class="c1"># nbu_storage_bytes{...}</span>
<a id="__codelineno-11-9" name="__codelineno-11-9" href="#__codelineno-11-9"></a><span class="c1"># nbu_jobs_count{...}</span>
<a id="__codelineno-11-10" name="__codelineno-11-10" href="#__codelineno-11-10"></a><span class="c1"># nbu_jobs_size_bytes{...}</span>
</code></pre></div>
<h3 id="level-3-api-communication">Level 3: API Communication</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a><span class="c1"># Check logs for successful API calls</span>
<a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a>tail<span class="w"> </span>-50<span class="w"> </span>log/nbu-exporter.log<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>-E<span class="w"> </span><span class="s2">&quot;Successfully fetched|API version&quot;</span>
<a id="__codelineno-12-3" name="__codelineno-12-3" href="#__codelineno-12-3"></a>
<a id="__codelineno-12-4" name="__codelineno-12-4" href="#__codelineno-12-4"></a><span class="c1"># Expected log entries:</span>
<a id="__codelineno-12-5" name="__codelineno-12-5" href="#__codelineno-12-5"></a><span class="c1"># INFO[...] Using NetBackup API version: 12.0</span>
<a id="__codelineno-12-6" name="__codelineno-12-6" href="#__codelineno-12-6"></a><span class="c1"># INFO[...] Successfully fetched storage data</span>
<a id="__codelineno-12-7" name="__codelineno-12-7" href="#__codelineno-12-7"></a><span class="c1"># INFO[...] Successfully fetched job data</span>
</code></pre></div>
<h3 id="level-4-data-validation">Level 4: Data Validation</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a><span class="c1"># Verify storage metrics have data</span>
<a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a>curl<span class="w"> </span>-s<span class="w"> </span>http://localhost:2112/metrics<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span><span class="s2">&quot;nbu_storage_bytes&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>wc<span class="w"> </span>-l
<a id="__codelineno-13-3" name="__codelineno-13-3" href="#__codelineno-13-3"></a><span class="c1"># Should be &gt; 0 if storage units exist</span>
<a id="__codelineno-13-4" name="__codelineno-13-4" href="#__codelineno-13-4"></a>
<a id="__codelineno-13-5" name="__codelineno-13-5" href="#__codelineno-13-5"></a><span class="c1"># Verify job metrics have data</span>
<a id="__codelineno-13-6" name="__codelineno-13-6" href="#__codelineno-13-6"></a>curl<span class="w"> </span>-s<span class="w"> </span>http://localhost:2112/metrics<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span><span class="s2">&quot;nbu_jobs_count&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>wc<span class="w"> </span>-l
<a id="__codelineno-13-7" name="__codelineno-13-7" href="#__codelineno-13-7"></a><span class="c1"># Should be &gt; 0 if jobs exist in time window</span>
<a id="__codelineno-13-8" name="__codelineno-13-8" href="#__codelineno-13-8"></a>
<a id="__codelineno-13-9" name="__codelineno-13-9" href="#__codelineno-13-9"></a><span class="c1"># Check metric values are reasonable</span>
<a id="__codelineno-13-10" name="__codelineno-13-10" href="#__codelineno-13-10"></a>curl<span class="w"> </span>-s<span class="w"> </span>http://localhost:2112/metrics<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span><span class="s2">&quot;nbu_storage_bytes&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span><span class="s2">&quot;size=\&quot;free\&quot;&quot;</span>
<a id="__codelineno-13-11" name="__codelineno-13-11" href="#__codelineno-13-11"></a>curl<span class="w"> </span>-s<span class="w"> </span>http://localhost:2112/metrics<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span><span class="s2">&quot;nbu_jobs_count&quot;</span>
</code></pre></div>
<h3 id="level-5-prometheus-integration">Level 5: Prometheus Integration</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a><span class="c1"># Query Prometheus to verify scraping</span>
<a id="__codelineno-14-2" name="__codelineno-14-2" href="#__codelineno-14-2"></a>curl<span class="w"> </span>-s<span class="w"> </span><span class="s1">&#39;http://prometheus:9090/api/v1/query?query=up{job=&quot;netbackup&quot;}&#39;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>jq<span class="w"> </span>.
<a id="__codelineno-14-3" name="__codelineno-14-3" href="#__codelineno-14-3"></a>
<a id="__codelineno-14-4" name="__codelineno-14-4" href="#__codelineno-14-4"></a><span class="c1"># Expected: &quot;value&quot;: [timestamp, &quot;1&quot;]</span>
<a id="__codelineno-14-5" name="__codelineno-14-5" href="#__codelineno-14-5"></a>
<a id="__codelineno-14-6" name="__codelineno-14-6" href="#__codelineno-14-6"></a><span class="c1"># Verify recent data</span>
<a id="__codelineno-14-7" name="__codelineno-14-7" href="#__codelineno-14-7"></a>curl<span class="w"> </span>-s<span class="w"> </span><span class="s1">&#39;http://prometheus:9090/api/v1/query?query=nbu_storage_bytes&#39;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>jq<span class="w"> </span>.
<a id="__codelineno-14-8" name="__codelineno-14-8" href="#__codelineno-14-8"></a>
<a id="__codelineno-14-9" name="__codelineno-14-9" href="#__codelineno-14-9"></a><span class="c1"># Check scrape duration</span>
<a id="__codelineno-14-10" name="__codelineno-14-10" href="#__codelineno-14-10"></a>curl<span class="w"> </span>-s<span class="w"> </span><span class="s1">&#39;http://prometheus:9090/api/v1/query?query=scrape_duration_seconds{job=&quot;netbackup&quot;}&#39;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>jq<span class="w"> </span>.
</code></pre></div>
<h3 id="level-6-grafana-dashboard">Level 6: Grafana Dashboard</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a><span class="c1"># Access Grafana dashboard</span>
<a id="__codelineno-15-2" name="__codelineno-15-2" href="#__codelineno-15-2"></a><span class="c1"># Navigate to: http://grafana:3000/d/netbackup-stats</span>
<a id="__codelineno-15-3" name="__codelineno-15-3" href="#__codelineno-15-3"></a>
<a id="__codelineno-15-4" name="__codelineno-15-4" href="#__codelineno-15-4"></a><span class="c1"># Verify panels show data:</span>
<a id="__codelineno-15-5" name="__codelineno-15-5" href="#__codelineno-15-5"></a><span class="c1"># - Storage capacity charts</span>
<a id="__codelineno-15-6" name="__codelineno-15-6" href="#__codelineno-15-6"></a><span class="c1"># - Job success rate graphs</span>
<a id="__codelineno-15-7" name="__codelineno-15-7" href="#__codelineno-15-7"></a><span class="c1"># - Data transfer volumes</span>
<a id="__codelineno-15-8" name="__codelineno-15-8" href="#__codelineno-15-8"></a><span class="c1"># - Job status distribution</span>
</code></pre></div>
<h2 id="backward-compatibility-verification">Backward Compatibility Verification</h2>
<h3 id="test-1-configuration-without-api-version">Test 1: Configuration Without API Version</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a><span class="c1"># Create test config without apiVersion field</span>
<a id="__codelineno-16-2" name="__codelineno-16-2" href="#__codelineno-16-2"></a>cat<span class="w"> </span>&gt;<span class="w"> </span>test-config-no-version.yaml<span class="w"> </span><span class="s">&lt;&lt; &#39;EOF&#39;</span>
<a id="__codelineno-16-3" name="__codelineno-16-3" href="#__codelineno-16-3"></a><span class="s">server:</span>
<a id="__codelineno-16-4" name="__codelineno-16-4" href="#__codelineno-16-4"></a><span class="s">    host: &quot;localhost&quot;</span>
<a id="__codelineno-16-5" name="__codelineno-16-5" href="#__codelineno-16-5"></a><span class="s">    port: &quot;2112&quot;</span>
<a id="__codelineno-16-6" name="__codelineno-16-6" href="#__codelineno-16-6"></a><span class="s">    uri: &quot;/metrics&quot;</span>
<a id="__codelineno-16-7" name="__codelineno-16-7" href="#__codelineno-16-7"></a><span class="s">    scrapingInterval: &quot;1h&quot;</span>
<a id="__codelineno-16-8" name="__codelineno-16-8" href="#__codelineno-16-8"></a><span class="s">    logName: &quot;log/test.log&quot;</span>
<a id="__codelineno-16-9" name="__codelineno-16-9" href="#__codelineno-16-9"></a><span class="s">nbuserver:</span>
<a id="__codelineno-16-10" name="__codelineno-16-10" href="#__codelineno-16-10"></a><span class="s">    scheme: &quot;https&quot;</span>
<a id="__codelineno-16-11" name="__codelineno-16-11" href="#__codelineno-16-11"></a><span class="s">    uri: &quot;/netbackup&quot;</span>
<a id="__codelineno-16-12" name="__codelineno-16-12" href="#__codelineno-16-12"></a><span class="s">    host: &quot;master.my.domain&quot;</span>
<a id="__codelineno-16-13" name="__codelineno-16-13" href="#__codelineno-16-13"></a><span class="s">    port: &quot;1556&quot;</span>
<a id="__codelineno-16-14" name="__codelineno-16-14" href="#__codelineno-16-14"></a><span class="s">    apiKey: &quot;test-key&quot;</span>
<a id="__codelineno-16-15" name="__codelineno-16-15" href="#__codelineno-16-15"></a><span class="s">    contentType: &quot;application/json&quot;</span>
<a id="__codelineno-16-16" name="__codelineno-16-16" href="#__codelineno-16-16"></a><span class="s">    insecureSkipVerify: false</span>
<a id="__codelineno-16-17" name="__codelineno-16-17" href="#__codelineno-16-17"></a><span class="s">EOF</span>
<a id="__codelineno-16-18" name="__codelineno-16-18" href="#__codelineno-16-18"></a>
<a id="__codelineno-16-19" name="__codelineno-16-19" href="#__codelineno-16-19"></a><span class="c1"># Test that it works with default version</span>
<a id="__codelineno-16-20" name="__codelineno-16-20" href="#__codelineno-16-20"></a>./bin/nbu_exporter<span class="w"> </span>--config<span class="w"> </span>test-config-no-version.yaml<span class="w"> </span>--debug<span class="w"> </span><span class="p">&amp;</span>
<a id="__codelineno-16-21" name="__codelineno-16-21" href="#__codelineno-16-21"></a><span class="nv">TEST_PID</span><span class="o">=</span><span class="nv">$!</span>
<a id="__codelineno-16-22" name="__codelineno-16-22" href="#__codelineno-16-22"></a>sleep<span class="w"> </span><span class="m">5</span>
<a id="__codelineno-16-23" name="__codelineno-16-23" href="#__codelineno-16-23"></a>
<a id="__codelineno-16-24" name="__codelineno-16-24" href="#__codelineno-16-24"></a><span class="c1"># Check logs for default version</span>
<a id="__codelineno-16-25" name="__codelineno-16-25" href="#__codelineno-16-25"></a>tail<span class="w"> </span>-20<span class="w"> </span>log/test.log<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span><span class="s2">&quot;Using NetBackup API version: 12.0&quot;</span>
<a id="__codelineno-16-26" name="__codelineno-16-26" href="#__codelineno-16-26"></a>
<a id="__codelineno-16-27" name="__codelineno-16-27" href="#__codelineno-16-27"></a><span class="c1"># Cleanup</span>
<a id="__codelineno-16-28" name="__codelineno-16-28" href="#__codelineno-16-28"></a><span class="nb">kill</span><span class="w"> </span>-TERM<span class="w"> </span><span class="nv">$TEST_PID</span>
<a id="__codelineno-16-29" name="__codelineno-16-29" href="#__codelineno-16-29"></a>rm<span class="w"> </span>test-config-no-version.yaml
</code></pre></div>
<h3 id="test-2-legacy-configuration-structure">Test 2: Legacy Configuration Structure</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a><span class="c1"># Test with old-style config (pre-10.5)</span>
<a id="__codelineno-17-2" name="__codelineno-17-2" href="#__codelineno-17-2"></a><span class="c1"># Should work with default API version</span>
<a id="__codelineno-17-3" name="__codelineno-17-3" href="#__codelineno-17-3"></a>./bin/nbu_exporter<span class="w"> </span>--config<span class="w"> </span>backups/*/config.yaml.backup<span class="w"> </span>--debug<span class="w"> </span><span class="p">&amp;</span>
<a id="__codelineno-17-4" name="__codelineno-17-4" href="#__codelineno-17-4"></a><span class="nv">LEGACY_PID</span><span class="o">=</span><span class="nv">$!</span>
<a id="__codelineno-17-5" name="__codelineno-17-5" href="#__codelineno-17-5"></a>sleep<span class="w"> </span><span class="m">5</span>
<a id="__codelineno-17-6" name="__codelineno-17-6" href="#__codelineno-17-6"></a>
<a id="__codelineno-17-7" name="__codelineno-17-7" href="#__codelineno-17-7"></a><span class="c1"># Verify it starts and defaults to 12.0</span>
<a id="__codelineno-17-8" name="__codelineno-17-8" href="#__codelineno-17-8"></a>tail<span class="w"> </span>-20<span class="w"> </span>log/nbu-exporter.log<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span><span class="s2">&quot;API version&quot;</span>
<a id="__codelineno-17-9" name="__codelineno-17-9" href="#__codelineno-17-9"></a>
<a id="__codelineno-17-10" name="__codelineno-17-10" href="#__codelineno-17-10"></a><span class="c1"># Cleanup</span>
<a id="__codelineno-17-11" name="__codelineno-17-11" href="#__codelineno-17-11"></a><span class="nb">kill</span><span class="w"> </span>-TERM<span class="w"> </span><span class="nv">$LEGACY_PID</span>
</code></pre></div>
<h3 id="test-3-metrics-consistency">Test 3: Metrics Consistency</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a><span class="c1"># Capture metrics before upgrade</span>
<a id="__codelineno-18-2" name="__codelineno-18-2" href="#__codelineno-18-2"></a>curl<span class="w"> </span>-s<span class="w"> </span>http://localhost:2112/metrics<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span><span class="s2">&quot;^nbu_&quot;</span><span class="w"> </span>&gt;<span class="w"> </span>metrics-before.txt
<a id="__codelineno-18-3" name="__codelineno-18-3" href="#__codelineno-18-3"></a>
<a id="__codelineno-18-4" name="__codelineno-18-4" href="#__codelineno-18-4"></a><span class="c1"># After upgrade, capture again</span>
<a id="__codelineno-18-5" name="__codelineno-18-5" href="#__codelineno-18-5"></a>curl<span class="w"> </span>-s<span class="w"> </span>http://localhost:2112/metrics<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span><span class="s2">&quot;^nbu_&quot;</span><span class="w"> </span>&gt;<span class="w"> </span>metrics-after.txt
<a id="__codelineno-18-6" name="__codelineno-18-6" href="#__codelineno-18-6"></a>
<a id="__codelineno-18-7" name="__codelineno-18-7" href="#__codelineno-18-7"></a><span class="c1"># Compare metric names (should be identical)</span>
<a id="__codelineno-18-8" name="__codelineno-18-8" href="#__codelineno-18-8"></a>diff<span class="w"> </span>&lt;<span class="o">(</span>cut<span class="w"> </span>-d<span class="s1">&#39;{&#39;</span><span class="w"> </span>-f1<span class="w"> </span>metrics-before.txt<span class="w"> </span><span class="p">|</span><span class="w"> </span>sort<span class="w"> </span>-u<span class="o">)</span><span class="w"> </span><span class="se">\</span>
<a id="__codelineno-18-9" name="__codelineno-18-9" href="#__codelineno-18-9"></a><span class="w">     </span>&lt;<span class="o">(</span>cut<span class="w"> </span>-d<span class="s1">&#39;{&#39;</span><span class="w"> </span>-f1<span class="w"> </span>metrics-after.txt<span class="w"> </span><span class="p">|</span><span class="w"> </span>sort<span class="w"> </span>-u<span class="o">)</span>
<a id="__codelineno-18-10" name="__codelineno-18-10" href="#__codelineno-18-10"></a>
<a id="__codelineno-18-11" name="__codelineno-18-11" href="#__codelineno-18-11"></a><span class="c1"># Expected: No differences in metric names</span>
</code></pre></div>
<h2 id="rollback-procedures">Rollback Procedures</h2>
<h3 id="when-to-rollback">When to Rollback</h3>
<p>Rollback if you encounter:</p>
<ul>
<li>Exporter fails to start after upgrade</li>
<li>HTTP 406 (Not Acceptable) errors from NetBackup API</li>
<li>Metrics collection failures</li>
<li>Prometheus scraping failures</li>
<li>Data inconsistencies or missing metrics</li>
</ul>
<h3 id="quick-rollback-5-minutes">Quick Rollback (&lt; 5 minutes)</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a><span class="c1"># Stop new version</span>
<a id="__codelineno-19-2" name="__codelineno-19-2" href="#__codelineno-19-2"></a>sudo<span class="w"> </span>systemctl<span class="w"> </span>stop<span class="w"> </span>nbu_exporter
<a id="__codelineno-19-3" name="__codelineno-19-3" href="#__codelineno-19-3"></a><span class="c1"># Or: docker stop nbu_exporter</span>
<a id="__codelineno-19-4" name="__codelineno-19-4" href="#__codelineno-19-4"></a><span class="c1"># Or: pkill -TERM nbu_exporter</span>
<a id="__codelineno-19-5" name="__codelineno-19-5" href="#__codelineno-19-5"></a>
<a id="__codelineno-19-6" name="__codelineno-19-6" href="#__codelineno-19-6"></a><span class="c1"># Restore binary</span>
<a id="__codelineno-19-7" name="__codelineno-19-7" href="#__codelineno-19-7"></a>cp<span class="w"> </span>backups/<span class="k">$(</span>ls<span class="w"> </span>-t<span class="w"> </span>backups/<span class="w"> </span><span class="p">|</span><span class="w"> </span>head<span class="w"> </span>-1<span class="k">)</span>/nbu_exporter.backup<span class="w"> </span>bin/nbu_exporter
<a id="__codelineno-19-8" name="__codelineno-19-8" href="#__codelineno-19-8"></a>
<a id="__codelineno-19-9" name="__codelineno-19-9" href="#__codelineno-19-9"></a><span class="c1"># Restore configuration</span>
<a id="__codelineno-19-10" name="__codelineno-19-10" href="#__codelineno-19-10"></a>cp<span class="w"> </span>backups/<span class="k">$(</span>ls<span class="w"> </span>-t<span class="w"> </span>backups/<span class="w"> </span><span class="p">|</span><span class="w"> </span>head<span class="w"> </span>-1<span class="k">)</span>/config.yaml.backup<span class="w"> </span>config.yaml
<a id="__codelineno-19-11" name="__codelineno-19-11" href="#__codelineno-19-11"></a>
<a id="__codelineno-19-12" name="__codelineno-19-12" href="#__codelineno-19-12"></a><span class="c1"># Start old version</span>
<a id="__codelineno-19-13" name="__codelineno-19-13" href="#__codelineno-19-13"></a>sudo<span class="w"> </span>systemctl<span class="w"> </span>start<span class="w"> </span>nbu_exporter
<a id="__codelineno-19-14" name="__codelineno-19-14" href="#__codelineno-19-14"></a><span class="c1"># Or: docker start nbu_exporter</span>
<a id="__codelineno-19-15" name="__codelineno-19-15" href="#__codelineno-19-15"></a><span class="c1"># Or: ./bin/nbu_exporter --config config.yaml &amp;</span>
<a id="__codelineno-19-16" name="__codelineno-19-16" href="#__codelineno-19-16"></a>
<a id="__codelineno-19-17" name="__codelineno-19-17" href="#__codelineno-19-17"></a><span class="c1"># Verify rollback</span>
<a id="__codelineno-19-18" name="__codelineno-19-18" href="#__codelineno-19-18"></a>curl<span class="w"> </span>http://localhost:2112/health
<a id="__codelineno-19-19" name="__codelineno-19-19" href="#__codelineno-19-19"></a>curl<span class="w"> </span>http://localhost:2112/metrics<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span><span class="s2">&quot;^nbu_&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>head<span class="w"> </span>-5
</code></pre></div>
<h3 id="detailed-rollback-steps">Detailed Rollback Steps</h3>
<h4 id="step-1-stop-new-version">Step 1: Stop New Version</h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a><span class="c1"># Systemd</span>
<a id="__codelineno-20-2" name="__codelineno-20-2" href="#__codelineno-20-2"></a>sudo<span class="w"> </span>systemctl<span class="w"> </span>stop<span class="w"> </span>nbu_exporter
<a id="__codelineno-20-3" name="__codelineno-20-3" href="#__codelineno-20-3"></a>sudo<span class="w"> </span>systemctl<span class="w"> </span>status<span class="w"> </span>nbu_exporter<span class="w">  </span><span class="c1"># Verify stopped</span>
<a id="__codelineno-20-4" name="__codelineno-20-4" href="#__codelineno-20-4"></a>
<a id="__codelineno-20-5" name="__codelineno-20-5" href="#__codelineno-20-5"></a><span class="c1"># Docker</span>
<a id="__codelineno-20-6" name="__codelineno-20-6" href="#__codelineno-20-6"></a>docker<span class="w"> </span>stop<span class="w"> </span>nbu_exporter
<a id="__codelineno-20-7" name="__codelineno-20-7" href="#__codelineno-20-7"></a>docker<span class="w"> </span>rm<span class="w"> </span>nbu_exporter
<a id="__codelineno-20-8" name="__codelineno-20-8" href="#__codelineno-20-8"></a>
<a id="__codelineno-20-9" name="__codelineno-20-9" href="#__codelineno-20-9"></a><span class="c1"># Manual</span>
<a id="__codelineno-20-10" name="__codelineno-20-10" href="#__codelineno-20-10"></a>pkill<span class="w"> </span>-TERM<span class="w"> </span>nbu_exporter
<a id="__codelineno-20-11" name="__codelineno-20-11" href="#__codelineno-20-11"></a>sleep<span class="w"> </span><span class="m">10</span>
<a id="__codelineno-20-12" name="__codelineno-20-12" href="#__codelineno-20-12"></a>pkill<span class="w"> </span>-9<span class="w"> </span>nbu_exporter<span class="w">  </span><span class="c1"># Force kill if needed</span>
</code></pre></div>
<h4 id="step-2-restore-previous-binary">Step 2: Restore Previous Binary</h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a><span class="c1"># Find most recent backup</span>
<a id="__codelineno-21-2" name="__codelineno-21-2" href="#__codelineno-21-2"></a><span class="nv">BACKUP_DIR</span><span class="o">=</span><span class="k">$(</span>ls<span class="w"> </span>-td<span class="w"> </span>backups/*/<span class="w"> </span><span class="p">|</span><span class="w"> </span>head<span class="w"> </span>-1<span class="k">)</span>
<a id="__codelineno-21-3" name="__codelineno-21-3" href="#__codelineno-21-3"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Restoring from: </span><span class="nv">$BACKUP_DIR</span><span class="s2">&quot;</span>
<a id="__codelineno-21-4" name="__codelineno-21-4" href="#__codelineno-21-4"></a>
<a id="__codelineno-21-5" name="__codelineno-21-5" href="#__codelineno-21-5"></a><span class="c1"># Restore binary</span>
<a id="__codelineno-21-6" name="__codelineno-21-6" href="#__codelineno-21-6"></a>cp<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">BACKUP_DIR</span><span class="si">}</span><span class="s2">nbu_exporter.backup&quot;</span><span class="w"> </span>bin/nbu_exporter
<a id="__codelineno-21-7" name="__codelineno-21-7" href="#__codelineno-21-7"></a>chmod<span class="w"> </span>+x<span class="w"> </span>bin/nbu_exporter
<a id="__codelineno-21-8" name="__codelineno-21-8" href="#__codelineno-21-8"></a>
<a id="__codelineno-21-9" name="__codelineno-21-9" href="#__codelineno-21-9"></a><span class="c1"># Verify binary</span>
<a id="__codelineno-21-10" name="__codelineno-21-10" href="#__codelineno-21-10"></a>ls<span class="w"> </span>-lh<span class="w"> </span>bin/nbu_exporter
</code></pre></div>
<h4 id="step-3-restore-previous-configuration">Step 3: Restore Previous Configuration</h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-22-1" name="__codelineno-22-1" href="#__codelineno-22-1"></a><span class="c1"># Restore config</span>
<a id="__codelineno-22-2" name="__codelineno-22-2" href="#__codelineno-22-2"></a>cp<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">BACKUP_DIR</span><span class="si">}</span><span class="s2">config.yaml.backup&quot;</span><span class="w"> </span>config.yaml
<a id="__codelineno-22-3" name="__codelineno-22-3" href="#__codelineno-22-3"></a>
<a id="__codelineno-22-4" name="__codelineno-22-4" href="#__codelineno-22-4"></a><span class="c1"># Verify config</span>
<a id="__codelineno-22-5" name="__codelineno-22-5" href="#__codelineno-22-5"></a>cat<span class="w"> </span>config.yaml<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>-A<span class="w"> </span><span class="m">15</span><span class="w"> </span><span class="s2">&quot;nbuserver:&quot;</span>
</code></pre></div>
<h4 id="step-4-restart-service">Step 4: Restart Service</h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-23-1" name="__codelineno-23-1" href="#__codelineno-23-1"></a><span class="c1"># Systemd</span>
<a id="__codelineno-23-2" name="__codelineno-23-2" href="#__codelineno-23-2"></a>sudo<span class="w"> </span>systemctl<span class="w"> </span>start<span class="w"> </span>nbu_exporter
<a id="__codelineno-23-3" name="__codelineno-23-3" href="#__codelineno-23-3"></a>sudo<span class="w"> </span>systemctl<span class="w"> </span>status<span class="w"> </span>nbu_exporter
<a id="__codelineno-23-4" name="__codelineno-23-4" href="#__codelineno-23-4"></a>
<a id="__codelineno-23-5" name="__codelineno-23-5" href="#__codelineno-23-5"></a><span class="c1"># Docker</span>
<a id="__codelineno-23-6" name="__codelineno-23-6" href="#__codelineno-23-6"></a>docker<span class="w"> </span>run<span class="w"> </span>-d<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-23-7" name="__codelineno-23-7" href="#__codelineno-23-7"></a><span class="w">  </span>--name<span class="w"> </span>nbu_exporter<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-23-8" name="__codelineno-23-8" href="#__codelineno-23-8"></a><span class="w">  </span>-p<span class="w"> </span><span class="m">2112</span>:2112<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-23-9" name="__codelineno-23-9" href="#__codelineno-23-9"></a><span class="w">  </span>-v<span class="w"> </span><span class="k">$(</span><span class="nb">pwd</span><span class="k">)</span>/config.yaml:/config.yaml<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-23-10" name="__codelineno-23-10" href="#__codelineno-23-10"></a><span class="w">  </span>--restart<span class="w"> </span>unless-stopped<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-23-11" name="__codelineno-23-11" href="#__codelineno-23-11"></a><span class="w">  </span>fjacquet/nbu_exporter:previous-version<span class="w"> </span>--config<span class="w"> </span>/config.yaml
<a id="__codelineno-23-12" name="__codelineno-23-12" href="#__codelineno-23-12"></a>
<a id="__codelineno-23-13" name="__codelineno-23-13" href="#__codelineno-23-13"></a><span class="c1"># Manual</span>
<a id="__codelineno-23-14" name="__codelineno-23-14" href="#__codelineno-23-14"></a>./bin/nbu_exporter<span class="w"> </span>--config<span class="w"> </span>config.yaml<span class="w"> </span><span class="p">&amp;</span>
<a id="__codelineno-23-15" name="__codelineno-23-15" href="#__codelineno-23-15"></a><span class="nb">echo</span><span class="w"> </span><span class="nv">$!</span><span class="w"> </span>&gt;<span class="w"> </span>nbu_exporter.pid
</code></pre></div>
<h4 id="step-5-verify-rollback-success">Step 5: Verify Rollback Success</h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-24-1" name="__codelineno-24-1" href="#__codelineno-24-1"></a><span class="c1"># Check health</span>
<a id="__codelineno-24-2" name="__codelineno-24-2" href="#__codelineno-24-2"></a>curl<span class="w"> </span>http://localhost:2112/health
<a id="__codelineno-24-3" name="__codelineno-24-3" href="#__codelineno-24-3"></a><span class="c1"># Expected: {&quot;status&quot;:&quot;healthy&quot;}</span>
<a id="__codelineno-24-4" name="__codelineno-24-4" href="#__codelineno-24-4"></a>
<a id="__codelineno-24-5" name="__codelineno-24-5" href="#__codelineno-24-5"></a><span class="c1"># Check metrics</span>
<a id="__codelineno-24-6" name="__codelineno-24-6" href="#__codelineno-24-6"></a>curl<span class="w"> </span>-s<span class="w"> </span>http://localhost:2112/metrics<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span><span class="s2">&quot;^nbu_&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>wc<span class="w"> </span>-l
<a id="__codelineno-24-7" name="__codelineno-24-7" href="#__codelineno-24-7"></a><span class="c1"># Should be &gt; 0</span>
<a id="__codelineno-24-8" name="__codelineno-24-8" href="#__codelineno-24-8"></a>
<a id="__codelineno-24-9" name="__codelineno-24-9" href="#__codelineno-24-9"></a><span class="c1"># Check logs</span>
<a id="__codelineno-24-10" name="__codelineno-24-10" href="#__codelineno-24-10"></a>tail<span class="w"> </span>-50<span class="w"> </span>log/nbu-exporter.log<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>-E<span class="w"> </span><span class="s2">&quot;ERROR|FATAL&quot;</span>
<a id="__codelineno-24-11" name="__codelineno-24-11" href="#__codelineno-24-11"></a><span class="c1"># Should be empty or minimal</span>
<a id="__codelineno-24-12" name="__codelineno-24-12" href="#__codelineno-24-12"></a>
<a id="__codelineno-24-13" name="__codelineno-24-13" href="#__codelineno-24-13"></a><span class="c1"># Verify Prometheus scraping</span>
<a id="__codelineno-24-14" name="__codelineno-24-14" href="#__codelineno-24-14"></a>curl<span class="w"> </span>-s<span class="w"> </span><span class="s1">&#39;http://prometheus:9090/api/v1/query?query=up{job=&quot;netbackup&quot;}&#39;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>jq<span class="w"> </span><span class="s1">&#39;.data.result[0].value[1]&#39;</span>
<a id="__codelineno-24-15" name="__codelineno-24-15" href="#__codelineno-24-15"></a><span class="c1"># Expected: &quot;1&quot;</span>
</code></pre></div>
<h4 id="step-6-document-rollback-reason">Step 6: Document Rollback Reason</h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-25-1" name="__codelineno-25-1" href="#__codelineno-25-1"></a><span class="c1"># Create incident report</span>
<a id="__codelineno-25-2" name="__codelineno-25-2" href="#__codelineno-25-2"></a>cat<span class="w"> </span>&gt;<span class="w"> </span>rollback-report-<span class="k">$(</span>date<span class="w"> </span>+%Y%m%d-%H%M%S<span class="k">)</span>.txt<span class="w"> </span><span class="s">&lt;&lt; EOF</span>
<a id="__codelineno-25-3" name="__codelineno-25-3" href="#__codelineno-25-3"></a><span class="s">Rollback Report</span>
<a id="__codelineno-25-4" name="__codelineno-25-4" href="#__codelineno-25-4"></a><span class="s">===============</span>
<a id="__codelineno-25-5" name="__codelineno-25-5" href="#__codelineno-25-5"></a><span class="s">Date: $(date)</span>
<a id="__codelineno-25-6" name="__codelineno-25-6" href="#__codelineno-25-6"></a><span class="s">Reason: [Describe why rollback was necessary]</span>
<a id="__codelineno-25-7" name="__codelineno-25-7" href="#__codelineno-25-7"></a><span class="s">Error Messages: [Copy relevant error messages]</span>
<a id="__codelineno-25-8" name="__codelineno-25-8" href="#__codelineno-25-8"></a><span class="s">NetBackup Version: [Version number]</span>
<a id="__codelineno-25-9" name="__codelineno-25-9" href="#__codelineno-25-9"></a><span class="s">Exporter Version Attempted: [Version]</span>
<a id="__codelineno-25-10" name="__codelineno-25-10" href="#__codelineno-25-10"></a><span class="s">Rolled Back To: [Previous version]</span>
<a id="__codelineno-25-11" name="__codelineno-25-11" href="#__codelineno-25-11"></a>
<a id="__codelineno-25-12" name="__codelineno-25-12" href="#__codelineno-25-12"></a><span class="s">Logs:</span>
<a id="__codelineno-25-13" name="__codelineno-25-13" href="#__codelineno-25-13"></a><span class="s">$(tail -100 log/nbu-exporter.log)</span>
<a id="__codelineno-25-14" name="__codelineno-25-14" href="#__codelineno-25-14"></a>
<a id="__codelineno-25-15" name="__codelineno-25-15" href="#__codelineno-25-15"></a><span class="s">Environment:</span>
<a id="__codelineno-25-16" name="__codelineno-25-16" href="#__codelineno-25-16"></a><span class="s">- OS: $(uname -a)</span>
<a id="__codelineno-25-17" name="__codelineno-25-17" href="#__codelineno-25-17"></a><span class="s">- Go Version: $(go version)</span>
<a id="__codelineno-25-18" name="__codelineno-25-18" href="#__codelineno-25-18"></a><span class="s">- NetBackup API Accessible: [yes/no]</span>
<a id="__codelineno-25-19" name="__codelineno-25-19" href="#__codelineno-25-19"></a>
<a id="__codelineno-25-20" name="__codelineno-25-20" href="#__codelineno-25-20"></a><span class="s">Next Steps:</span>
<a id="__codelineno-25-21" name="__codelineno-25-21" href="#__codelineno-25-21"></a><span class="s">- [ ] Report issue to GitHub</span>
<a id="__codelineno-25-22" name="__codelineno-25-22" href="#__codelineno-25-22"></a><span class="s">- [ ] Investigate root cause</span>
<a id="__codelineno-25-23" name="__codelineno-25-23" href="#__codelineno-25-23"></a><span class="s">- [ ] Plan retry with fixes</span>
<a id="__codelineno-25-24" name="__codelineno-25-24" href="#__codelineno-25-24"></a><span class="s">EOF</span>
<a id="__codelineno-25-25" name="__codelineno-25-25" href="#__codelineno-25-25"></a>
<a id="__codelineno-25-26" name="__codelineno-25-26" href="#__codelineno-25-26"></a><span class="c1"># Report issue</span>
<a id="__codelineno-25-27" name="__codelineno-25-27" href="#__codelineno-25-27"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Please report this issue at: https://github.com/fjacquet/nbu_exporter/issues&quot;</span>
</code></pre></div>
<h2 id="breaking-changes-verification">Breaking Changes Verification</h2>
<h3 id="verification-test-suite">Verification Test Suite</h3>
<p>Run this test suite to ensure no breaking changes:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-26-1" name="__codelineno-26-1" href="#__codelineno-26-1"></a><span class="ch">#!/bin/bash</span>
<a id="__codelineno-26-2" name="__codelineno-26-2" href="#__codelineno-26-2"></a><span class="c1"># save as: verify-no-breaking-changes.sh</span>
<a id="__codelineno-26-3" name="__codelineno-26-3" href="#__codelineno-26-3"></a>
<a id="__codelineno-26-4" name="__codelineno-26-4" href="#__codelineno-26-4"></a><span class="nb">set</span><span class="w"> </span>-e
<a id="__codelineno-26-5" name="__codelineno-26-5" href="#__codelineno-26-5"></a>
<a id="__codelineno-26-6" name="__codelineno-26-6" href="#__codelineno-26-6"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;=== NBU Exporter Breaking Changes Verification ===&quot;</span>
<a id="__codelineno-26-7" name="__codelineno-26-7" href="#__codelineno-26-7"></a><span class="nb">echo</span>
<a id="__codelineno-26-8" name="__codelineno-26-8" href="#__codelineno-26-8"></a>
<a id="__codelineno-26-9" name="__codelineno-26-9" href="#__codelineno-26-9"></a><span class="c1"># Test 1: Configuration without API version</span>
<a id="__codelineno-26-10" name="__codelineno-26-10" href="#__codelineno-26-10"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Test 1: Configuration without API version field&quot;</span>
<a id="__codelineno-26-11" name="__codelineno-26-11" href="#__codelineno-26-11"></a>cat<span class="w"> </span>&gt;<span class="w"> </span>/tmp/test-config-1.yaml<span class="w"> </span><span class="s">&lt;&lt; &#39;EOF&#39;</span>
<a id="__codelineno-26-12" name="__codelineno-26-12" href="#__codelineno-26-12"></a><span class="s">server:</span>
<a id="__codelineno-26-13" name="__codelineno-26-13" href="#__codelineno-26-13"></a><span class="s">    host: &quot;localhost&quot;</span>
<a id="__codelineno-26-14" name="__codelineno-26-14" href="#__codelineno-26-14"></a><span class="s">    port: &quot;2112&quot;</span>
<a id="__codelineno-26-15" name="__codelineno-26-15" href="#__codelineno-26-15"></a><span class="s">    uri: &quot;/metrics&quot;</span>
<a id="__codelineno-26-16" name="__codelineno-26-16" href="#__codelineno-26-16"></a><span class="s">    scrapingInterval: &quot;5m&quot;</span>
<a id="__codelineno-26-17" name="__codelineno-26-17" href="#__codelineno-26-17"></a><span class="s">    logName: &quot;/tmp/test1.log&quot;</span>
<a id="__codelineno-26-18" name="__codelineno-26-18" href="#__codelineno-26-18"></a><span class="s">nbuserver:</span>
<a id="__codelineno-26-19" name="__codelineno-26-19" href="#__codelineno-26-19"></a><span class="s">    scheme: &quot;https&quot;</span>
<a id="__codelineno-26-20" name="__codelineno-26-20" href="#__codelineno-26-20"></a><span class="s">    uri: &quot;/netbackup&quot;</span>
<a id="__codelineno-26-21" name="__codelineno-26-21" href="#__codelineno-26-21"></a><span class="s">    host: &quot;test.example.com&quot;</span>
<a id="__codelineno-26-22" name="__codelineno-26-22" href="#__codelineno-26-22"></a><span class="s">    port: &quot;1556&quot;</span>
<a id="__codelineno-26-23" name="__codelineno-26-23" href="#__codelineno-26-23"></a><span class="s">    apiKey: &quot;test-key&quot;</span>
<a id="__codelineno-26-24" name="__codelineno-26-24" href="#__codelineno-26-24"></a><span class="s">    contentType: &quot;application/json&quot;</span>
<a id="__codelineno-26-25" name="__codelineno-26-25" href="#__codelineno-26-25"></a><span class="s">EOF</span>
<a id="__codelineno-26-26" name="__codelineno-26-26" href="#__codelineno-26-26"></a>
<a id="__codelineno-26-27" name="__codelineno-26-27" href="#__codelineno-26-27"></a>./bin/nbu_exporter<span class="w"> </span>--config<span class="w"> </span>/tmp/test-config-1.yaml<span class="w"> </span>--debug<span class="w"> </span><span class="p">&amp;</span>
<a id="__codelineno-26-28" name="__codelineno-26-28" href="#__codelineno-26-28"></a><span class="nv">PID1</span><span class="o">=</span><span class="nv">$!</span>
<a id="__codelineno-26-29" name="__codelineno-26-29" href="#__codelineno-26-29"></a>sleep<span class="w"> </span><span class="m">3</span>
<a id="__codelineno-26-30" name="__codelineno-26-30" href="#__codelineno-26-30"></a><span class="k">if</span><span class="w"> </span>ps<span class="w"> </span>-p<span class="w"> </span><span class="nv">$PID1</span><span class="w"> </span>&gt;<span class="w"> </span>/dev/null<span class="p">;</span><span class="w"> </span><span class="k">then</span>
<a id="__codelineno-26-31" name="__codelineno-26-31" href="#__codelineno-26-31"></a><span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot; PASS: Exporter starts without API version field&quot;</span>
<a id="__codelineno-26-32" name="__codelineno-26-32" href="#__codelineno-26-32"></a><span class="w">    </span><span class="nb">kill</span><span class="w"> </span>-TERM<span class="w"> </span><span class="nv">$PID1</span>
<a id="__codelineno-26-33" name="__codelineno-26-33" href="#__codelineno-26-33"></a><span class="k">else</span>
<a id="__codelineno-26-34" name="__codelineno-26-34" href="#__codelineno-26-34"></a><span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot; FAIL: Exporter failed to start without API version field&quot;</span>
<a id="__codelineno-26-35" name="__codelineno-26-35" href="#__codelineno-26-35"></a><span class="w">    </span><span class="nb">exit</span><span class="w"> </span><span class="m">1</span>
<a id="__codelineno-26-36" name="__codelineno-26-36" href="#__codelineno-26-36"></a><span class="k">fi</span>
<a id="__codelineno-26-37" name="__codelineno-26-37" href="#__codelineno-26-37"></a><span class="nb">echo</span>
<a id="__codelineno-26-38" name="__codelineno-26-38" href="#__codelineno-26-38"></a>
<a id="__codelineno-26-39" name="__codelineno-26-39" href="#__codelineno-26-39"></a><span class="c1"># Test 2: Legacy configuration structure</span>
<a id="__codelineno-26-40" name="__codelineno-26-40" href="#__codelineno-26-40"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Test 2: Legacy configuration structure&quot;</span>
<a id="__codelineno-26-41" name="__codelineno-26-41" href="#__codelineno-26-41"></a>cat<span class="w"> </span>&gt;<span class="w"> </span>/tmp/test-config-2.yaml<span class="w"> </span><span class="s">&lt;&lt; &#39;EOF&#39;</span>
<a id="__codelineno-26-42" name="__codelineno-26-42" href="#__codelineno-26-42"></a><span class="s">server:</span>
<a id="__codelineno-26-43" name="__codelineno-26-43" href="#__codelineno-26-43"></a><span class="s">    host: &quot;localhost&quot;</span>
<a id="__codelineno-26-44" name="__codelineno-26-44" href="#__codelineno-26-44"></a><span class="s">    port: &quot;2113&quot;</span>
<a id="__codelineno-26-45" name="__codelineno-26-45" href="#__codelineno-26-45"></a><span class="s">    uri: &quot;/metrics&quot;</span>
<a id="__codelineno-26-46" name="__codelineno-26-46" href="#__codelineno-26-46"></a><span class="s">    scrapingInterval: &quot;1h&quot;</span>
<a id="__codelineno-26-47" name="__codelineno-26-47" href="#__codelineno-26-47"></a><span class="s">    logName: &quot;/tmp/test2.log&quot;</span>
<a id="__codelineno-26-48" name="__codelineno-26-48" href="#__codelineno-26-48"></a><span class="s">nbuserver:</span>
<a id="__codelineno-26-49" name="__codelineno-26-49" href="#__codelineno-26-49"></a><span class="s">    scheme: &quot;https&quot;</span>
<a id="__codelineno-26-50" name="__codelineno-26-50" href="#__codelineno-26-50"></a><span class="s">    uri: &quot;/netbackup&quot;</span>
<a id="__codelineno-26-51" name="__codelineno-26-51" href="#__codelineno-26-51"></a><span class="s">    domain: &quot;example.com&quot;</span>
<a id="__codelineno-26-52" name="__codelineno-26-52" href="#__codelineno-26-52"></a><span class="s">    domainType: &quot;NT&quot;</span>
<a id="__codelineno-26-53" name="__codelineno-26-53" href="#__codelineno-26-53"></a><span class="s">    host: &quot;master.example.com&quot;</span>
<a id="__codelineno-26-54" name="__codelineno-26-54" href="#__codelineno-26-54"></a><span class="s">    port: &quot;1556&quot;</span>
<a id="__codelineno-26-55" name="__codelineno-26-55" href="#__codelineno-26-55"></a><span class="s">    apiKey: &quot;legacy-key&quot;</span>
<a id="__codelineno-26-56" name="__codelineno-26-56" href="#__codelineno-26-56"></a><span class="s">    contentType: &quot;application/json&quot;</span>
<a id="__codelineno-26-57" name="__codelineno-26-57" href="#__codelineno-26-57"></a><span class="s">    insecureSkipVerify: false</span>
<a id="__codelineno-26-58" name="__codelineno-26-58" href="#__codelineno-26-58"></a><span class="s">EOF</span>
<a id="__codelineno-26-59" name="__codelineno-26-59" href="#__codelineno-26-59"></a>
<a id="__codelineno-26-60" name="__codelineno-26-60" href="#__codelineno-26-60"></a>./bin/nbu_exporter<span class="w"> </span>--config<span class="w"> </span>/tmp/test-config-2.yaml<span class="w"> </span>--debug<span class="w"> </span><span class="p">&amp;</span>
<a id="__codelineno-26-61" name="__codelineno-26-61" href="#__codelineno-26-61"></a><span class="nv">PID2</span><span class="o">=</span><span class="nv">$!</span>
<a id="__codelineno-26-62" name="__codelineno-26-62" href="#__codelineno-26-62"></a>sleep<span class="w"> </span><span class="m">3</span>
<a id="__codelineno-26-63" name="__codelineno-26-63" href="#__codelineno-26-63"></a><span class="k">if</span><span class="w"> </span>ps<span class="w"> </span>-p<span class="w"> </span><span class="nv">$PID2</span><span class="w"> </span>&gt;<span class="w"> </span>/dev/null<span class="p">;</span><span class="w"> </span><span class="k">then</span>
<a id="__codelineno-26-64" name="__codelineno-26-64" href="#__codelineno-26-64"></a><span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot; PASS: Exporter works with legacy config structure&quot;</span>
<a id="__codelineno-26-65" name="__codelineno-26-65" href="#__codelineno-26-65"></a><span class="w">    </span><span class="nb">kill</span><span class="w"> </span>-TERM<span class="w"> </span><span class="nv">$PID2</span>
<a id="__codelineno-26-66" name="__codelineno-26-66" href="#__codelineno-26-66"></a><span class="k">else</span>
<a id="__codelineno-26-67" name="__codelineno-26-67" href="#__codelineno-26-67"></a><span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot; FAIL: Exporter failed with legacy config&quot;</span>
<a id="__codelineno-26-68" name="__codelineno-26-68" href="#__codelineno-26-68"></a><span class="w">    </span><span class="nb">exit</span><span class="w"> </span><span class="m">1</span>
<a id="__codelineno-26-69" name="__codelineno-26-69" href="#__codelineno-26-69"></a><span class="k">fi</span>
<a id="__codelineno-26-70" name="__codelineno-26-70" href="#__codelineno-26-70"></a><span class="nb">echo</span>
<a id="__codelineno-26-71" name="__codelineno-26-71" href="#__codelineno-26-71"></a>
<a id="__codelineno-26-72" name="__codelineno-26-72" href="#__codelineno-26-72"></a><span class="c1"># Test 3: Metric names unchanged</span>
<a id="__codelineno-26-73" name="__codelineno-26-73" href="#__codelineno-26-73"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Test 3: Metric names consistency&quot;</span>
<a id="__codelineno-26-74" name="__codelineno-26-74" href="#__codelineno-26-74"></a><span class="nv">EXPECTED_METRICS</span><span class="o">=(</span>
<a id="__codelineno-26-75" name="__codelineno-26-75" href="#__codelineno-26-75"></a><span class="w">    </span><span class="s2">&quot;nbu_storage_bytes&quot;</span>
<a id="__codelineno-26-76" name="__codelineno-26-76" href="#__codelineno-26-76"></a><span class="w">    </span><span class="s2">&quot;nbu_jobs_count&quot;</span>
<a id="__codelineno-26-77" name="__codelineno-26-77" href="#__codelineno-26-77"></a><span class="w">    </span><span class="s2">&quot;nbu_jobs_size_bytes&quot;</span>
<a id="__codelineno-26-78" name="__codelineno-26-78" href="#__codelineno-26-78"></a><span class="o">)</span>
<a id="__codelineno-26-79" name="__codelineno-26-79" href="#__codelineno-26-79"></a>
<a id="__codelineno-26-80" name="__codelineno-26-80" href="#__codelineno-26-80"></a><span class="k">for</span><span class="w"> </span>metric<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">EXPECTED_METRICS</span><span class="p">[@]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">;</span><span class="w"> </span><span class="k">do</span>
<a id="__codelineno-26-81" name="__codelineno-26-81" href="#__codelineno-26-81"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span>curl<span class="w"> </span>-s<span class="w"> </span>http://localhost:2112/metrics<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>-q<span class="w"> </span><span class="s2">&quot;^# HELP </span><span class="nv">$metric</span><span class="s2">&quot;</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<a id="__codelineno-26-82" name="__codelineno-26-82" href="#__codelineno-26-82"></a><span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot; PASS: Metric </span><span class="nv">$metric</span><span class="s2"> exists&quot;</span>
<a id="__codelineno-26-83" name="__codelineno-26-83" href="#__codelineno-26-83"></a><span class="w">    </span><span class="k">else</span>
<a id="__codelineno-26-84" name="__codelineno-26-84" href="#__codelineno-26-84"></a><span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot; FAIL: Metric </span><span class="nv">$metric</span><span class="s2"> missing&quot;</span>
<a id="__codelineno-26-85" name="__codelineno-26-85" href="#__codelineno-26-85"></a><span class="w">        </span><span class="nb">exit</span><span class="w"> </span><span class="m">1</span>
<a id="__codelineno-26-86" name="__codelineno-26-86" href="#__codelineno-26-86"></a><span class="w">    </span><span class="k">fi</span>
<a id="__codelineno-26-87" name="__codelineno-26-87" href="#__codelineno-26-87"></a><span class="k">done</span>
<a id="__codelineno-26-88" name="__codelineno-26-88" href="#__codelineno-26-88"></a><span class="nb">echo</span>
<a id="__codelineno-26-89" name="__codelineno-26-89" href="#__codelineno-26-89"></a>
<a id="__codelineno-26-90" name="__codelineno-26-90" href="#__codelineno-26-90"></a><span class="c1"># Test 4: Default API version</span>
<a id="__codelineno-26-91" name="__codelineno-26-91" href="#__codelineno-26-91"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Test 4: Default API version is 12.0&quot;</span>
<a id="__codelineno-26-92" name="__codelineno-26-92" href="#__codelineno-26-92"></a><span class="k">if</span><span class="w"> </span>grep<span class="w"> </span>-q<span class="w"> </span><span class="s2">&quot;Using NetBackup API version: 12.0&quot;</span><span class="w"> </span>/tmp/test1.log<span class="p">;</span><span class="w"> </span><span class="k">then</span>
<a id="__codelineno-26-93" name="__codelineno-26-93" href="#__codelineno-26-93"></a><span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot; PASS: Default API version is 12.0&quot;</span>
<a id="__codelineno-26-94" name="__codelineno-26-94" href="#__codelineno-26-94"></a><span class="k">else</span>
<a id="__codelineno-26-95" name="__codelineno-26-95" href="#__codelineno-26-95"></a><span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot; FAIL: Default API version is not 12.0&quot;</span>
<a id="__codelineno-26-96" name="__codelineno-26-96" href="#__codelineno-26-96"></a><span class="w">    </span><span class="nb">exit</span><span class="w"> </span><span class="m">1</span>
<a id="__codelineno-26-97" name="__codelineno-26-97" href="#__codelineno-26-97"></a><span class="k">fi</span>
<a id="__codelineno-26-98" name="__codelineno-26-98" href="#__codelineno-26-98"></a><span class="nb">echo</span>
<a id="__codelineno-26-99" name="__codelineno-26-99" href="#__codelineno-26-99"></a>
<a id="__codelineno-26-100" name="__codelineno-26-100" href="#__codelineno-26-100"></a><span class="c1"># Cleanup</span>
<a id="__codelineno-26-101" name="__codelineno-26-101" href="#__codelineno-26-101"></a>rm<span class="w"> </span>-f<span class="w"> </span>/tmp/test-config-*.yaml<span class="w"> </span>/tmp/test*.log
<a id="__codelineno-26-102" name="__codelineno-26-102" href="#__codelineno-26-102"></a>
<a id="__codelineno-26-103" name="__codelineno-26-103" href="#__codelineno-26-103"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;=== All Breaking Changes Tests Passed ===&quot;</span>
</code></pre></div>
<h2 id="post-deployment-monitoring">Post-Deployment Monitoring</h2>
<h3 id="first-24-hours">First 24 Hours</h3>
<p>Monitor these metrics closely:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-27-1" name="__codelineno-27-1" href="#__codelineno-27-1"></a><span class="c1"># Check error rate</span>
<a id="__codelineno-27-2" name="__codelineno-27-2" href="#__codelineno-27-2"></a>curl<span class="w"> </span>-s<span class="w"> </span>http://localhost:2112/metrics<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span><span class="s2">&quot;nbu_scrape_errors_total&quot;</span>
<a id="__codelineno-27-3" name="__codelineno-27-3" href="#__codelineno-27-3"></a>
<a id="__codelineno-27-4" name="__codelineno-27-4" href="#__codelineno-27-4"></a><span class="c1"># Check scrape duration</span>
<a id="__codelineno-27-5" name="__codelineno-27-5" href="#__codelineno-27-5"></a>curl<span class="w"> </span>-s<span class="w"> </span>http://localhost:2112/metrics<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span><span class="s2">&quot;nbu_scrape_duration_seconds&quot;</span>
<a id="__codelineno-27-6" name="__codelineno-27-6" href="#__codelineno-27-6"></a>
<a id="__codelineno-27-7" name="__codelineno-27-7" href="#__codelineno-27-7"></a><span class="c1"># Monitor logs for errors</span>
<a id="__codelineno-27-8" name="__codelineno-27-8" href="#__codelineno-27-8"></a>tail<span class="w"> </span>-f<span class="w"> </span>log/nbu-exporter.log<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>-E<span class="w"> </span><span class="s2">&quot;ERROR|WARN&quot;</span>
<a id="__codelineno-27-9" name="__codelineno-27-9" href="#__codelineno-27-9"></a>
<a id="__codelineno-27-10" name="__codelineno-27-10" href="#__codelineno-27-10"></a><span class="c1"># Check Prometheus scrape success</span>
<a id="__codelineno-27-11" name="__codelineno-27-11" href="#__codelineno-27-11"></a>curl<span class="w"> </span>-s<span class="w"> </span><span class="s1">&#39;http://prometheus:9090/api/v1/query?query=up{job=&quot;netbackup&quot;}&#39;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>jq<span class="w"> </span>.
</code></pre></div>
<h3 id="alerting-rules">Alerting Rules</h3>
<p>Add these Prometheus alerting rules:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-28-1" name="__codelineno-28-1" href="#__codelineno-28-1"></a><span class="nt">groups</span><span class="p">:</span>
<a id="__codelineno-28-2" name="__codelineno-28-2" href="#__codelineno-28-2"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nbu_exporter</span>
<a id="__codelineno-28-3" name="__codelineno-28-3" href="#__codelineno-28-3"></a><span class="w">    </span><span class="nt">interval</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">60s</span>
<a id="__codelineno-28-4" name="__codelineno-28-4" href="#__codelineno-28-4"></a><span class="w">    </span><span class="nt">rules</span><span class="p">:</span>
<a id="__codelineno-28-5" name="__codelineno-28-5" href="#__codelineno-28-5"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">alert</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">NBUExporterDown</span>
<a id="__codelineno-28-6" name="__codelineno-28-6" href="#__codelineno-28-6"></a><span class="w">        </span><span class="nt">expr</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">up{job=&quot;netbackup&quot;} == 0</span>
<a id="__codelineno-28-7" name="__codelineno-28-7" href="#__codelineno-28-7"></a><span class="w">        </span><span class="nt">for</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5m</span>
<a id="__codelineno-28-8" name="__codelineno-28-8" href="#__codelineno-28-8"></a><span class="w">        </span><span class="nt">labels</span><span class="p">:</span>
<a id="__codelineno-28-9" name="__codelineno-28-9" href="#__codelineno-28-9"></a><span class="w">          </span><span class="nt">severity</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">critical</span>
<a id="__codelineno-28-10" name="__codelineno-28-10" href="#__codelineno-28-10"></a><span class="w">        </span><span class="nt">annotations</span><span class="p">:</span>
<a id="__codelineno-28-11" name="__codelineno-28-11" href="#__codelineno-28-11"></a><span class="w">          </span><span class="nt">summary</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;NBU</span><span class="nv"> </span><span class="s">Exporter</span><span class="nv"> </span><span class="s">is</span><span class="nv"> </span><span class="s">down&quot;</span>
<a id="__codelineno-28-12" name="__codelineno-28-12" href="#__codelineno-28-12"></a><span class="w">          </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;NBU</span><span class="nv"> </span><span class="s">Exporter</span><span class="nv"> </span><span class="s">has</span><span class="nv"> </span><span class="s">been</span><span class="nv"> </span><span class="s">down</span><span class="nv"> </span><span class="s">for</span><span class="nv"> </span><span class="s">more</span><span class="nv"> </span><span class="s">than</span><span class="nv"> </span><span class="s">5</span><span class="nv"> </span><span class="s">minutes&quot;</span>
<a id="__codelineno-28-13" name="__codelineno-28-13" href="#__codelineno-28-13"></a>
<a id="__codelineno-28-14" name="__codelineno-28-14" href="#__codelineno-28-14"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">alert</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">NBUExporterScrapeFailing</span>
<a id="__codelineno-28-15" name="__codelineno-28-15" href="#__codelineno-28-15"></a><span class="w">        </span><span class="nt">expr</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">increase(nbu_scrape_errors_total[5m]) &gt; 3</span>
<a id="__codelineno-28-16" name="__codelineno-28-16" href="#__codelineno-28-16"></a><span class="w">        </span><span class="nt">for</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5m</span>
<a id="__codelineno-28-17" name="__codelineno-28-17" href="#__codelineno-28-17"></a><span class="w">        </span><span class="nt">labels</span><span class="p">:</span>
<a id="__codelineno-28-18" name="__codelineno-28-18" href="#__codelineno-28-18"></a><span class="w">          </span><span class="nt">severity</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">warning</span>
<a id="__codelineno-28-19" name="__codelineno-28-19" href="#__codelineno-28-19"></a><span class="w">        </span><span class="nt">annotations</span><span class="p">:</span>
<a id="__codelineno-28-20" name="__codelineno-28-20" href="#__codelineno-28-20"></a><span class="w">          </span><span class="nt">summary</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;NBU</span><span class="nv"> </span><span class="s">Exporter</span><span class="nv"> </span><span class="s">scrape</span><span class="nv"> </span><span class="s">errors&quot;</span>
<a id="__codelineno-28-21" name="__codelineno-28-21" href="#__codelineno-28-21"></a><span class="w">          </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;NBU</span><span class="nv"> </span><span class="s">Exporter</span><span class="nv"> </span><span class="s">has</span><span class="nv"> </span><span class="s">had</span><span class="nv"> </span><span class="s">{{</span><span class="nv"> </span><span class="s">$value</span><span class="nv"> </span><span class="s">}}</span><span class="nv"> </span><span class="s">scrape</span><span class="nv"> </span><span class="s">errors</span><span class="nv"> </span><span class="s">in</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">last</span><span class="nv"> </span><span class="s">5</span><span class="nv"> </span><span class="s">minutes&quot;</span>
<a id="__codelineno-28-22" name="__codelineno-28-22" href="#__codelineno-28-22"></a>
<a id="__codelineno-28-23" name="__codelineno-28-23" href="#__codelineno-28-23"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">alert</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">NBUExporterSlowScrape</span>
<a id="__codelineno-28-24" name="__codelineno-28-24" href="#__codelineno-28-24"></a><span class="w">        </span><span class="nt">expr</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nbu_scrape_duration_seconds &gt; 30</span>
<a id="__codelineno-28-25" name="__codelineno-28-25" href="#__codelineno-28-25"></a><span class="w">        </span><span class="nt">for</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10m</span>
<a id="__codelineno-28-26" name="__codelineno-28-26" href="#__codelineno-28-26"></a><span class="w">        </span><span class="nt">labels</span><span class="p">:</span>
<a id="__codelineno-28-27" name="__codelineno-28-27" href="#__codelineno-28-27"></a><span class="w">          </span><span class="nt">severity</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">warning</span>
<a id="__codelineno-28-28" name="__codelineno-28-28" href="#__codelineno-28-28"></a><span class="w">        </span><span class="nt">annotations</span><span class="p">:</span>
<a id="__codelineno-28-29" name="__codelineno-28-29" href="#__codelineno-28-29"></a><span class="w">          </span><span class="nt">summary</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;NBU</span><span class="nv"> </span><span class="s">Exporter</span><span class="nv"> </span><span class="s">slow</span><span class="nv"> </span><span class="s">scrapes&quot;</span>
<a id="__codelineno-28-30" name="__codelineno-28-30" href="#__codelineno-28-30"></a><span class="w">          </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;NBU</span><span class="nv"> </span><span class="s">Exporter</span><span class="nv"> </span><span class="s">scrapes</span><span class="nv"> </span><span class="s">are</span><span class="nv"> </span><span class="s">taking</span><span class="nv"> </span><span class="s">longer</span><span class="nv"> </span><span class="s">than</span><span class="nv"> </span><span class="s">30</span><span class="nv"> </span><span class="s">seconds&quot;</span>
</code></pre></div>
<h3 id="performance-baseline">Performance Baseline</h3>
<p>Establish performance baselines:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-29-1" name="__codelineno-29-1" href="#__codelineno-29-1"></a><span class="c1"># Scrape duration baseline</span>
<a id="__codelineno-29-2" name="__codelineno-29-2" href="#__codelineno-29-2"></a>curl<span class="w"> </span>-s<span class="w"> </span>http://localhost:2112/metrics<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span><span class="s2">&quot;nbu_scrape_duration_seconds&quot;</span>
<a id="__codelineno-29-3" name="__codelineno-29-3" href="#__codelineno-29-3"></a>
<a id="__codelineno-29-4" name="__codelineno-29-4" href="#__codelineno-29-4"></a><span class="c1"># Memory usage baseline</span>
<a id="__codelineno-29-5" name="__codelineno-29-5" href="#__codelineno-29-5"></a>ps<span class="w"> </span>aux<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>nbu_exporter<span class="w"> </span><span class="p">|</span><span class="w"> </span>awk<span class="w"> </span><span class="s1">&#39;{print $6}&#39;</span>
<a id="__codelineno-29-6" name="__codelineno-29-6" href="#__codelineno-29-6"></a>
<a id="__codelineno-29-7" name="__codelineno-29-7" href="#__codelineno-29-7"></a><span class="c1"># API response times (from logs)</span>
<a id="__codelineno-29-8" name="__codelineno-29-8" href="#__codelineno-29-8"></a>grep<span class="w"> </span><span class="s2">&quot;Successfully fetched&quot;</span><span class="w"> </span>log/nbu-exporter.log<span class="w"> </span><span class="p">|</span><span class="w"> </span>tail<span class="w"> </span>-20
</code></pre></div>
<h2 id="troubleshooting-deployment-issues">Troubleshooting Deployment Issues</h2>
<h3 id="issue-exporter-wont-start">Issue: Exporter Won't Start</h3>
<p><strong>Symptoms:</strong>
- Process exits immediately
- No logs generated
- Health endpoint not accessible</p>
<p><strong>Diagnosis:</strong></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-30-1" name="__codelineno-30-1" href="#__codelineno-30-1"></a><span class="c1"># Run in foreground with debug</span>
<a id="__codelineno-30-2" name="__codelineno-30-2" href="#__codelineno-30-2"></a>./bin/nbu_exporter<span class="w"> </span>--config<span class="w"> </span>config.yaml<span class="w"> </span>--debug
<a id="__codelineno-30-3" name="__codelineno-30-3" href="#__codelineno-30-3"></a>
<a id="__codelineno-30-4" name="__codelineno-30-4" href="#__codelineno-30-4"></a><span class="c1"># Check for configuration errors</span>
<a id="__codelineno-30-5" name="__codelineno-30-5" href="#__codelineno-30-5"></a>./bin/nbu_exporter<span class="w"> </span>--config<span class="w"> </span>config.yaml<span class="w"> </span><span class="m">2</span>&gt;<span class="p">&amp;</span><span class="m">1</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>-i<span class="w"> </span>error
<a id="__codelineno-30-6" name="__codelineno-30-6" href="#__codelineno-30-6"></a>
<a id="__codelineno-30-7" name="__codelineno-30-7" href="#__codelineno-30-7"></a><span class="c1"># Verify config file syntax</span>
<a id="__codelineno-30-8" name="__codelineno-30-8" href="#__codelineno-30-8"></a>cat<span class="w"> </span>config.yaml<span class="w"> </span><span class="p">|</span><span class="w"> </span>python<span class="w"> </span>-m<span class="w"> </span>yaml
</code></pre></div>
<p><strong>Solutions:</strong>
1. Check configuration file path is correct
2. Verify YAML syntax is valid
3. Ensure all required fields are present
4. Check file permissions on config and log directory</p>
<h3 id="issue-api-version-errors">Issue: API Version Errors</h3>
<p><strong>Symptoms:</strong>
- HTTP 406 (Not Acceptable) errors
- "Invalid API version format" errors</p>
<p><strong>Diagnosis:</strong></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-31-1" name="__codelineno-31-1" href="#__codelineno-31-1"></a><span class="c1"># Check NetBackup version</span>
<a id="__codelineno-31-2" name="__codelineno-31-2" href="#__codelineno-31-2"></a>ssh<span class="w"> </span>netbackup-master<span class="w"> </span><span class="s2">&quot;bpgetconfig -g | grep VERSION&quot;</span>
<a id="__codelineno-31-3" name="__codelineno-31-3" href="#__codelineno-31-3"></a>
<a id="__codelineno-31-4" name="__codelineno-31-4" href="#__codelineno-31-4"></a><span class="c1"># Check configured API version</span>
<a id="__codelineno-31-5" name="__codelineno-31-5" href="#__codelineno-31-5"></a>grep<span class="w"> </span>apiVersion<span class="w"> </span>config.yaml
<a id="__codelineno-31-6" name="__codelineno-31-6" href="#__codelineno-31-6"></a>
<a id="__codelineno-31-7" name="__codelineno-31-7" href="#__codelineno-31-7"></a><span class="c1"># Test API manually</span>
<a id="__codelineno-31-8" name="__codelineno-31-8" href="#__codelineno-31-8"></a>curl<span class="w"> </span>-k<span class="w"> </span>-H<span class="w"> </span><span class="s2">&quot;Authorization: YOUR_API_KEY&quot;</span><span class="w"> </span><span class="se">\</span>
<a id="__codelineno-31-9" name="__codelineno-31-9" href="#__codelineno-31-9"></a><span class="w">  </span>-H<span class="w"> </span><span class="s2">&quot;Accept: application/vnd.netbackup+json;version=12.0&quot;</span><span class="w"> </span><span class="se">\</span>
<a id="__codelineno-31-10" name="__codelineno-31-10" href="#__codelineno-31-10"></a><span class="w">  </span>https://netbackup-master:1556/netbackup/config/servers/master
</code></pre></div>
<p><strong>Solutions:</strong>
1. Verify NetBackup is version 10.5 or later
2. Ensure apiVersion is set to "12.0" (string format)
3. Check API version format: must be "X.Y" (e.g., "12.0", not "12" or "v12.0")</p>
<h3 id="issue-metrics-not-updating">Issue: Metrics Not Updating</h3>
<p><strong>Symptoms:</strong>
- Stale data in Prometheus
- No new metrics after upgrade
- Empty metric values</p>
<p><strong>Diagnosis:</strong></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-32-1" name="__codelineno-32-1" href="#__codelineno-32-1"></a><span class="c1"># Check exporter logs</span>
<a id="__codelineno-32-2" name="__codelineno-32-2" href="#__codelineno-32-2"></a>tail<span class="w"> </span>-100<span class="w"> </span>log/nbu-exporter.log<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>-E<span class="w"> </span><span class="s2">&quot;ERROR|Successfully&quot;</span>
<a id="__codelineno-32-3" name="__codelineno-32-3" href="#__codelineno-32-3"></a>
<a id="__codelineno-32-4" name="__codelineno-32-4" href="#__codelineno-32-4"></a><span class="c1"># Test metrics endpoint</span>
<a id="__codelineno-32-5" name="__codelineno-32-5" href="#__codelineno-32-5"></a>curl<span class="w"> </span>-s<span class="w"> </span>http://localhost:2112/metrics<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span><span class="s2">&quot;^nbu_&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>wc<span class="w"> </span>-l
<a id="__codelineno-32-6" name="__codelineno-32-6" href="#__codelineno-32-6"></a>
<a id="__codelineno-32-7" name="__codelineno-32-7" href="#__codelineno-32-7"></a><span class="c1"># Check Prometheus scraping</span>
<a id="__codelineno-32-8" name="__codelineno-32-8" href="#__codelineno-32-8"></a>curl<span class="w"> </span>-s<span class="w"> </span><span class="s1">&#39;http://prometheus:9090/api/v1/query?query=up{job=&quot;netbackup&quot;}&#39;</span>
<a id="__codelineno-32-9" name="__codelineno-32-9" href="#__codelineno-32-9"></a>
<a id="__codelineno-32-10" name="__codelineno-32-10" href="#__codelineno-32-10"></a><span class="c1"># Verify NetBackup API access</span>
<a id="__codelineno-32-11" name="__codelineno-32-11" href="#__codelineno-32-11"></a>curl<span class="w"> </span>-k<span class="w"> </span>-H<span class="w"> </span><span class="s2">&quot;Authorization: YOUR_API_KEY&quot;</span><span class="w"> </span><span class="se">\</span>
<a id="__codelineno-32-12" name="__codelineno-32-12" href="#__codelineno-32-12"></a><span class="w">  </span>https://netbackup-master:1556/netbackup/storage/storage-units
</code></pre></div>
<p><strong>Solutions:</strong>
1. Verify API key is valid and not expired
2. Check network connectivity to NetBackup server
3. Ensure firewall allows traffic on port 1556
4. Verify scraping interval is appropriate
5. Check NetBackup has data to export (storage units, jobs)</p>
<h2 id="deployment-checklist">Deployment Checklist</h2>
<p>Use this checklist for each deployment:</p>
<h3 id="pre-deployment">Pre-Deployment</h3>
<ul>
<li>[ ] NetBackup version verified (10.5+)</li>
<li>[ ] API key validated and has required permissions</li>
<li>[ ] Network connectivity tested</li>
<li>[ ] Current configuration backed up</li>
<li>[ ] Current binary backed up</li>
<li>[ ] Prometheus configuration reviewed</li>
<li>[ ] Maintenance window scheduled (if required)</li>
<li>[ ] Rollback plan reviewed</li>
</ul>
<h3 id="deployment">Deployment</h3>
<ul>
<li>[ ] Exporter stopped gracefully</li>
<li>[ ] New binary deployed</li>
<li>[ ] Configuration updated with apiVersion</li>
<li>[ ] Configuration validated</li>
<li>[ ] Exporter started</li>
<li>[ ] Health check passed</li>
<li>[ ] Metrics endpoint responding</li>
<li>[ ] Logs show successful API calls</li>
</ul>
<h3 id="post-deployment">Post-Deployment</h3>
<ul>
<li>[ ] Prometheus scraping successfully</li>
<li>[ ] Grafana dashboard showing data</li>
<li>[ ] No errors in logs (first 15 minutes)</li>
<li>[ ] Metric values are reasonable</li>
<li>[ ] Backward compatibility verified</li>
<li>[ ] Performance baseline established</li>
<li>[ ] Monitoring alerts configured</li>
<li>[ ] Documentation updated</li>
<li>[ ] Team notified of successful deployment</li>
</ul>
<h3 id="rollback-if-needed">Rollback (If Needed)</h3>
<ul>
<li>[ ] Issue documented</li>
<li>[ ] Exporter stopped</li>
<li>[ ] Previous binary restored</li>
<li>[ ] Previous configuration restored</li>
<li>[ ] Exporter restarted</li>
<li>[ ] Rollback verified</li>
<li>[ ] Incident report created</li>
<li>[ ] GitHub issue created</li>
</ul>
<h2 id="automation-scripts">Automation Scripts</h2>
<h3 id="deployment-script">Deployment Script</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-33-1" name="__codelineno-33-1" href="#__codelineno-33-1"></a><span class="ch">#!/bin/bash</span>
<a id="__codelineno-33-2" name="__codelineno-33-2" href="#__codelineno-33-2"></a><span class="c1"># deploy-nbu-exporter.sh</span>
<a id="__codelineno-33-3" name="__codelineno-33-3" href="#__codelineno-33-3"></a>
<a id="__codelineno-33-4" name="__codelineno-33-4" href="#__codelineno-33-4"></a><span class="nb">set</span><span class="w"> </span>-e
<a id="__codelineno-33-5" name="__codelineno-33-5" href="#__codelineno-33-5"></a>
<a id="__codelineno-33-6" name="__codelineno-33-6" href="#__codelineno-33-6"></a><span class="nv">BACKUP_DIR</span><span class="o">=</span><span class="s2">&quot;backups/</span><span class="k">$(</span>date<span class="w"> </span>+%Y%m%d-%H%M%S<span class="k">)</span><span class="s2">&quot;</span>
<a id="__codelineno-33-7" name="__codelineno-33-7" href="#__codelineno-33-7"></a><span class="nv">CONFIG_FILE</span><span class="o">=</span><span class="s2">&quot;config.yaml&quot;</span>
<a id="__codelineno-33-8" name="__codelineno-33-8" href="#__codelineno-33-8"></a><span class="nv">BINARY_PATH</span><span class="o">=</span><span class="s2">&quot;bin/nbu_exporter&quot;</span>
<a id="__codelineno-33-9" name="__codelineno-33-9" href="#__codelineno-33-9"></a>
<a id="__codelineno-33-10" name="__codelineno-33-10" href="#__codelineno-33-10"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;=== NBU Exporter Deployment Script ===&quot;</span>
<a id="__codelineno-33-11" name="__codelineno-33-11" href="#__codelineno-33-11"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Backup directory: </span><span class="nv">$BACKUP_DIR</span><span class="s2">&quot;</span>
<a id="__codelineno-33-12" name="__codelineno-33-12" href="#__codelineno-33-12"></a><span class="nb">echo</span>
<a id="__codelineno-33-13" name="__codelineno-33-13" href="#__codelineno-33-13"></a>
<a id="__codelineno-33-14" name="__codelineno-33-14" href="#__codelineno-33-14"></a><span class="c1"># Create backup</span>
<a id="__codelineno-33-15" name="__codelineno-33-15" href="#__codelineno-33-15"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Creating backup...&quot;</span>
<a id="__codelineno-33-16" name="__codelineno-33-16" href="#__codelineno-33-16"></a>mkdir<span class="w"> </span>-p<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$BACKUP_DIR</span><span class="s2">&quot;</span>
<a id="__codelineno-33-17" name="__codelineno-33-17" href="#__codelineno-33-17"></a>cp<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$CONFIG_FILE</span><span class="s2">&quot;</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$BACKUP_DIR</span><span class="s2">/config.yaml.backup&quot;</span>
<a id="__codelineno-33-18" name="__codelineno-33-18" href="#__codelineno-33-18"></a>cp<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$BINARY_PATH</span><span class="s2">&quot;</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$BACKUP_DIR</span><span class="s2">/nbu_exporter.backup&quot;</span>
<a id="__codelineno-33-19" name="__codelineno-33-19" href="#__codelineno-33-19"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot; Backup created&quot;</span>
<a id="__codelineno-33-20" name="__codelineno-33-20" href="#__codelineno-33-20"></a><span class="nb">echo</span>
<a id="__codelineno-33-21" name="__codelineno-33-21" href="#__codelineno-33-21"></a>
<a id="__codelineno-33-22" name="__codelineno-33-22" href="#__codelineno-33-22"></a><span class="c1"># Stop exporter</span>
<a id="__codelineno-33-23" name="__codelineno-33-23" href="#__codelineno-33-23"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Stopping exporter...&quot;</span>
<a id="__codelineno-33-24" name="__codelineno-33-24" href="#__codelineno-33-24"></a><span class="k">if</span><span class="w"> </span>systemctl<span class="w"> </span>is-active<span class="w"> </span>--quiet<span class="w"> </span>nbu_exporter<span class="p">;</span><span class="w"> </span><span class="k">then</span>
<a id="__codelineno-33-25" name="__codelineno-33-25" href="#__codelineno-33-25"></a><span class="w">    </span>sudo<span class="w"> </span>systemctl<span class="w"> </span>stop<span class="w"> </span>nbu_exporter
<a id="__codelineno-33-26" name="__codelineno-33-26" href="#__codelineno-33-26"></a><span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot; Systemd service stopped&quot;</span>
<a id="__codelineno-33-27" name="__codelineno-33-27" href="#__codelineno-33-27"></a><span class="k">elif</span><span class="w"> </span>pgrep<span class="w"> </span>-x<span class="w"> </span>nbu_exporter<span class="w"> </span>&gt;<span class="w"> </span>/dev/null<span class="p">;</span><span class="w"> </span><span class="k">then</span>
<a id="__codelineno-33-28" name="__codelineno-33-28" href="#__codelineno-33-28"></a><span class="w">    </span>pkill<span class="w"> </span>-TERM<span class="w"> </span>nbu_exporter
<a id="__codelineno-33-29" name="__codelineno-33-29" href="#__codelineno-33-29"></a><span class="w">    </span>sleep<span class="w"> </span><span class="m">5</span>
<a id="__codelineno-33-30" name="__codelineno-33-30" href="#__codelineno-33-30"></a><span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot; Process stopped&quot;</span>
<a id="__codelineno-33-31" name="__codelineno-33-31" href="#__codelineno-33-31"></a><span class="k">else</span>
<a id="__codelineno-33-32" name="__codelineno-33-32" href="#__codelineno-33-32"></a><span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot; Exporter not running&quot;</span>
<a id="__codelineno-33-33" name="__codelineno-33-33" href="#__codelineno-33-33"></a><span class="k">fi</span>
<a id="__codelineno-33-34" name="__codelineno-33-34" href="#__codelineno-33-34"></a><span class="nb">echo</span>
<a id="__codelineno-33-35" name="__codelineno-33-35" href="#__codelineno-33-35"></a>
<a id="__codelineno-33-36" name="__codelineno-33-36" href="#__codelineno-33-36"></a><span class="c1"># Update binary</span>
<a id="__codelineno-33-37" name="__codelineno-33-37" href="#__codelineno-33-37"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Updating binary...&quot;</span>
<a id="__codelineno-33-38" name="__codelineno-33-38" href="#__codelineno-33-38"></a><span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span>-f<span class="w"> </span><span class="s2">&quot;nbu_exporter-new&quot;</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<a id="__codelineno-33-39" name="__codelineno-33-39" href="#__codelineno-33-39"></a><span class="w">    </span>cp<span class="w"> </span>nbu_exporter-new<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$BINARY_PATH</span><span class="s2">&quot;</span>
<a id="__codelineno-33-40" name="__codelineno-33-40" href="#__codelineno-33-40"></a><span class="w">    </span>chmod<span class="w"> </span>+x<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$BINARY_PATH</span><span class="s2">&quot;</span>
<a id="__codelineno-33-41" name="__codelineno-33-41" href="#__codelineno-33-41"></a><span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot; Binary updated&quot;</span>
<a id="__codelineno-33-42" name="__codelineno-33-42" href="#__codelineno-33-42"></a><span class="k">else</span>
<a id="__codelineno-33-43" name="__codelineno-33-43" href="#__codelineno-33-43"></a><span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot; New binary not found: nbu_exporter-new&quot;</span>
<a id="__codelineno-33-44" name="__codelineno-33-44" href="#__codelineno-33-44"></a><span class="w">    </span><span class="nb">exit</span><span class="w"> </span><span class="m">1</span>
<a id="__codelineno-33-45" name="__codelineno-33-45" href="#__codelineno-33-45"></a><span class="k">fi</span>
<a id="__codelineno-33-46" name="__codelineno-33-46" href="#__codelineno-33-46"></a><span class="nb">echo</span>
<a id="__codelineno-33-47" name="__codelineno-33-47" href="#__codelineno-33-47"></a>
<a id="__codelineno-33-48" name="__codelineno-33-48" href="#__codelineno-33-48"></a><span class="c1"># Update configuration</span>
<a id="__codelineno-33-49" name="__codelineno-33-49" href="#__codelineno-33-49"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Updating configuration...&quot;</span>
<a id="__codelineno-33-50" name="__codelineno-33-50" href="#__codelineno-33-50"></a><span class="k">if</span><span class="w"> </span>!<span class="w"> </span>grep<span class="w"> </span>-q<span class="w"> </span><span class="s2">&quot;apiVersion:&quot;</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$CONFIG_FILE</span><span class="s2">&quot;</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<a id="__codelineno-33-51" name="__codelineno-33-51" href="#__codelineno-33-51"></a><span class="w">    </span>sed<span class="w"> </span>-i<span class="w"> </span><span class="s1">&#39;/nbuserver:/a\    apiVersion: &quot;12.0&quot;&#39;</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$CONFIG_FILE</span><span class="s2">&quot;</span>
<a id="__codelineno-33-52" name="__codelineno-33-52" href="#__codelineno-33-52"></a><span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot; Added apiVersion to config&quot;</span>
<a id="__codelineno-33-53" name="__codelineno-33-53" href="#__codelineno-33-53"></a><span class="k">else</span>
<a id="__codelineno-33-54" name="__codelineno-33-54" href="#__codelineno-33-54"></a><span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot; apiVersion already present&quot;</span>
<a id="__codelineno-33-55" name="__codelineno-33-55" href="#__codelineno-33-55"></a><span class="k">fi</span>
<a id="__codelineno-33-56" name="__codelineno-33-56" href="#__codelineno-33-56"></a><span class="nb">echo</span>
<a id="__codelineno-33-57" name="__codelineno-33-57" href="#__codelineno-33-57"></a>
<a id="__codelineno-33-58" name="__codelineno-33-58" href="#__codelineno-33-58"></a><span class="c1"># Validate configuration</span>
<a id="__codelineno-33-59" name="__codelineno-33-59" href="#__codelineno-33-59"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Validating configuration...&quot;</span>
<a id="__codelineno-33-60" name="__codelineno-33-60" href="#__codelineno-33-60"></a>timeout<span class="w"> </span>10s<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$BINARY_PATH</span><span class="s2">&quot;</span><span class="w"> </span>--config<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$CONFIG_FILE</span><span class="s2">&quot;</span><span class="w"> </span>--debug<span class="w"> </span><span class="p">&amp;</span>
<a id="__codelineno-33-61" name="__codelineno-33-61" href="#__codelineno-33-61"></a><span class="nv">VALIDATE_PID</span><span class="o">=</span><span class="nv">$!</span>
<a id="__codelineno-33-62" name="__codelineno-33-62" href="#__codelineno-33-62"></a>sleep<span class="w"> </span><span class="m">5</span>
<a id="__codelineno-33-63" name="__codelineno-33-63" href="#__codelineno-33-63"></a><span class="k">if</span><span class="w"> </span>ps<span class="w"> </span>-p<span class="w"> </span><span class="nv">$VALIDATE_PID</span><span class="w"> </span>&gt;<span class="w"> </span>/dev/null<span class="p">;</span><span class="w"> </span><span class="k">then</span>
<a id="__codelineno-33-64" name="__codelineno-33-64" href="#__codelineno-33-64"></a><span class="w">    </span><span class="nb">kill</span><span class="w"> </span>-TERM<span class="w"> </span><span class="nv">$VALIDATE_PID</span>
<a id="__codelineno-33-65" name="__codelineno-33-65" href="#__codelineno-33-65"></a><span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot; Configuration valid&quot;</span>
<a id="__codelineno-33-66" name="__codelineno-33-66" href="#__codelineno-33-66"></a><span class="k">else</span>
<a id="__codelineno-33-67" name="__codelineno-33-67" href="#__codelineno-33-67"></a><span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot; Configuration validation failed&quot;</span>
<a id="__codelineno-33-68" name="__codelineno-33-68" href="#__codelineno-33-68"></a><span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Rolling back...&quot;</span>
<a id="__codelineno-33-69" name="__codelineno-33-69" href="#__codelineno-33-69"></a><span class="w">    </span>cp<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$BACKUP_DIR</span><span class="s2">/config.yaml.backup&quot;</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$CONFIG_FILE</span><span class="s2">&quot;</span>
<a id="__codelineno-33-70" name="__codelineno-33-70" href="#__codelineno-33-70"></a><span class="w">    </span>cp<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$BACKUP_DIR</span><span class="s2">/nbu_exporter.backup&quot;</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$BINARY_PATH</span><span class="s2">&quot;</span>
<a id="__codelineno-33-71" name="__codelineno-33-71" href="#__codelineno-33-71"></a><span class="w">    </span><span class="nb">exit</span><span class="w"> </span><span class="m">1</span>
<a id="__codelineno-33-72" name="__codelineno-33-72" href="#__codelineno-33-72"></a><span class="k">fi</span>
<a id="__codelineno-33-73" name="__codelineno-33-73" href="#__codelineno-33-73"></a><span class="nb">echo</span>
<a id="__codelineno-33-74" name="__codelineno-33-74" href="#__codelineno-33-74"></a>
<a id="__codelineno-33-75" name="__codelineno-33-75" href="#__codelineno-33-75"></a><span class="c1"># Start exporter</span>
<a id="__codelineno-33-76" name="__codelineno-33-76" href="#__codelineno-33-76"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Starting exporter...&quot;</span>
<a id="__codelineno-33-77" name="__codelineno-33-77" href="#__codelineno-33-77"></a><span class="k">if</span><span class="w"> </span>systemctl<span class="w"> </span>list-unit-files<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>-q<span class="w"> </span>nbu_exporter.service<span class="p">;</span><span class="w"> </span><span class="k">then</span>
<a id="__codelineno-33-78" name="__codelineno-33-78" href="#__codelineno-33-78"></a><span class="w">    </span>sudo<span class="w"> </span>systemctl<span class="w"> </span>start<span class="w"> </span>nbu_exporter
<a id="__codelineno-33-79" name="__codelineno-33-79" href="#__codelineno-33-79"></a><span class="w">    </span>sleep<span class="w"> </span><span class="m">3</span>
<a id="__codelineno-33-80" name="__codelineno-33-80" href="#__codelineno-33-80"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span>systemctl<span class="w"> </span>is-active<span class="w"> </span>--quiet<span class="w"> </span>nbu_exporter<span class="p">;</span><span class="w"> </span><span class="k">then</span>
<a id="__codelineno-33-81" name="__codelineno-33-81" href="#__codelineno-33-81"></a><span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot; Systemd service started&quot;</span>
<a id="__codelineno-33-82" name="__codelineno-33-82" href="#__codelineno-33-82"></a><span class="w">    </span><span class="k">else</span>
<a id="__codelineno-33-83" name="__codelineno-33-83" href="#__codelineno-33-83"></a><span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot; Failed to start systemd service&quot;</span>
<a id="__codelineno-33-84" name="__codelineno-33-84" href="#__codelineno-33-84"></a><span class="w">        </span><span class="nb">exit</span><span class="w"> </span><span class="m">1</span>
<a id="__codelineno-33-85" name="__codelineno-33-85" href="#__codelineno-33-85"></a><span class="w">    </span><span class="k">fi</span>
<a id="__codelineno-33-86" name="__codelineno-33-86" href="#__codelineno-33-86"></a><span class="k">else</span>
<a id="__codelineno-33-87" name="__codelineno-33-87" href="#__codelineno-33-87"></a><span class="w">    </span>nohup<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$BINARY_PATH</span><span class="s2">&quot;</span><span class="w"> </span>--config<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$CONFIG_FILE</span><span class="s2">&quot;</span><span class="w"> </span>&gt;<span class="w"> </span>/dev/null<span class="w"> </span><span class="m">2</span>&gt;<span class="p">&amp;</span><span class="m">1</span><span class="w"> </span><span class="p">&amp;</span>
<a id="__codelineno-33-88" name="__codelineno-33-88" href="#__codelineno-33-88"></a><span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="nv">$!</span><span class="w"> </span>&gt;<span class="w"> </span>nbu_exporter.pid
<a id="__codelineno-33-89" name="__codelineno-33-89" href="#__codelineno-33-89"></a><span class="w">    </span>sleep<span class="w"> </span><span class="m">3</span>
<a id="__codelineno-33-90" name="__codelineno-33-90" href="#__codelineno-33-90"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span>ps<span class="w"> </span>-p<span class="w"> </span><span class="k">$(</span>cat<span class="w"> </span>nbu_exporter.pid<span class="k">)</span><span class="w"> </span>&gt;<span class="w"> </span>/dev/null<span class="p">;</span><span class="w"> </span><span class="k">then</span>
<a id="__codelineno-33-91" name="__codelineno-33-91" href="#__codelineno-33-91"></a><span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot; Process started&quot;</span>
<a id="__codelineno-33-92" name="__codelineno-33-92" href="#__codelineno-33-92"></a><span class="w">    </span><span class="k">else</span>
<a id="__codelineno-33-93" name="__codelineno-33-93" href="#__codelineno-33-93"></a><span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot; Failed to start process&quot;</span>
<a id="__codelineno-33-94" name="__codelineno-33-94" href="#__codelineno-33-94"></a><span class="w">        </span><span class="nb">exit</span><span class="w"> </span><span class="m">1</span>
<a id="__codelineno-33-95" name="__codelineno-33-95" href="#__codelineno-33-95"></a><span class="w">    </span><span class="k">fi</span>
<a id="__codelineno-33-96" name="__codelineno-33-96" href="#__codelineno-33-96"></a><span class="k">fi</span>
<a id="__codelineno-33-97" name="__codelineno-33-97" href="#__codelineno-33-97"></a><span class="nb">echo</span>
<a id="__codelineno-33-98" name="__codelineno-33-98" href="#__codelineno-33-98"></a>
<a id="__codelineno-33-99" name="__codelineno-33-99" href="#__codelineno-33-99"></a><span class="c1"># Verify deployment</span>
<a id="__codelineno-33-100" name="__codelineno-33-100" href="#__codelineno-33-100"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Verifying deployment...&quot;</span>
<a id="__codelineno-33-101" name="__codelineno-33-101" href="#__codelineno-33-101"></a><span class="k">if</span><span class="w"> </span>curl<span class="w"> </span>-sf<span class="w"> </span>http://localhost:2112/health<span class="w"> </span>&gt;<span class="w"> </span>/dev/null<span class="p">;</span><span class="w"> </span><span class="k">then</span>
<a id="__codelineno-33-102" name="__codelineno-33-102" href="#__codelineno-33-102"></a><span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot; Health check passed&quot;</span>
<a id="__codelineno-33-103" name="__codelineno-33-103" href="#__codelineno-33-103"></a><span class="k">else</span>
<a id="__codelineno-33-104" name="__codelineno-33-104" href="#__codelineno-33-104"></a><span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot; Health check failed&quot;</span>
<a id="__codelineno-33-105" name="__codelineno-33-105" href="#__codelineno-33-105"></a><span class="w">    </span><span class="nb">exit</span><span class="w"> </span><span class="m">1</span>
<a id="__codelineno-33-106" name="__codelineno-33-106" href="#__codelineno-33-106"></a><span class="k">fi</span>
<a id="__codelineno-33-107" name="__codelineno-33-107" href="#__codelineno-33-107"></a>
<a id="__codelineno-33-108" name="__codelineno-33-108" href="#__codelineno-33-108"></a><span class="k">if</span><span class="w"> </span>curl<span class="w"> </span>-s<span class="w"> </span>http://localhost:2112/metrics<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>-q<span class="w"> </span><span class="s2">&quot;^nbu_&quot;</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<a id="__codelineno-33-109" name="__codelineno-33-109" href="#__codelineno-33-109"></a><span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot; Metrics available&quot;</span>
<a id="__codelineno-33-110" name="__codelineno-33-110" href="#__codelineno-33-110"></a><span class="k">else</span>
<a id="__codelineno-33-111" name="__codelineno-33-111" href="#__codelineno-33-111"></a><span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot; Metrics not available&quot;</span>
<a id="__codelineno-33-112" name="__codelineno-33-112" href="#__codelineno-33-112"></a><span class="w">    </span><span class="nb">exit</span><span class="w"> </span><span class="m">1</span>
<a id="__codelineno-33-113" name="__codelineno-33-113" href="#__codelineno-33-113"></a><span class="k">fi</span>
<a id="__codelineno-33-114" name="__codelineno-33-114" href="#__codelineno-33-114"></a>
<a id="__codelineno-33-115" name="__codelineno-33-115" href="#__codelineno-33-115"></a><span class="nb">echo</span>
<a id="__codelineno-33-116" name="__codelineno-33-116" href="#__codelineno-33-116"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;=== Deployment Successful ===&quot;</span>
<a id="__codelineno-33-117" name="__codelineno-33-117" href="#__codelineno-33-117"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Backup location: </span><span class="nv">$BACKUP_DIR</span><span class="s2">&quot;</span>
<a id="__codelineno-33-118" name="__codelineno-33-118" href="#__codelineno-33-118"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Monitor logs: tail -f log/nbu-exporter.log&quot;</span>
</code></pre></div>
<h3 id="rollback-script">Rollback Script</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-34-1" name="__codelineno-34-1" href="#__codelineno-34-1"></a><span class="ch">#!/bin/bash</span>
<a id="__codelineno-34-2" name="__codelineno-34-2" href="#__codelineno-34-2"></a><span class="c1"># rollback-nbu-exporter.sh</span>
<a id="__codelineno-34-3" name="__codelineno-34-3" href="#__codelineno-34-3"></a>
<a id="__codelineno-34-4" name="__codelineno-34-4" href="#__codelineno-34-4"></a><span class="nb">set</span><span class="w"> </span>-e
<a id="__codelineno-34-5" name="__codelineno-34-5" href="#__codelineno-34-5"></a>
<a id="__codelineno-34-6" name="__codelineno-34-6" href="#__codelineno-34-6"></a><span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span>-z<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$1</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<a id="__codelineno-34-7" name="__codelineno-34-7" href="#__codelineno-34-7"></a><span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Usage: </span><span class="nv">$0</span><span class="s2"> &lt;backup-directory&gt;&quot;</span>
<a id="__codelineno-34-8" name="__codelineno-34-8" href="#__codelineno-34-8"></a><span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Available backups:&quot;</span>
<a id="__codelineno-34-9" name="__codelineno-34-9" href="#__codelineno-34-9"></a><span class="w">    </span>ls<span class="w"> </span>-1d<span class="w"> </span>backups/*/
<a id="__codelineno-34-10" name="__codelineno-34-10" href="#__codelineno-34-10"></a><span class="w">    </span><span class="nb">exit</span><span class="w"> </span><span class="m">1</span>
<a id="__codelineno-34-11" name="__codelineno-34-11" href="#__codelineno-34-11"></a><span class="k">fi</span>
<a id="__codelineno-34-12" name="__codelineno-34-12" href="#__codelineno-34-12"></a>
<a id="__codelineno-34-13" name="__codelineno-34-13" href="#__codelineno-34-13"></a><span class="nv">BACKUP_DIR</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$1</span><span class="s2">&quot;</span>
<a id="__codelineno-34-14" name="__codelineno-34-14" href="#__codelineno-34-14"></a><span class="nv">CONFIG_FILE</span><span class="o">=</span><span class="s2">&quot;config.yaml&quot;</span>
<a id="__codelineno-34-15" name="__codelineno-34-15" href="#__codelineno-34-15"></a><span class="nv">BINARY_PATH</span><span class="o">=</span><span class="s2">&quot;bin/nbu_exporter&quot;</span>
<a id="__codelineno-34-16" name="__codelineno-34-16" href="#__codelineno-34-16"></a>
<a id="__codelineno-34-17" name="__codelineno-34-17" href="#__codelineno-34-17"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;=== NBU Exporter Rollback Script ===&quot;</span>
<a id="__codelineno-34-18" name="__codelineno-34-18" href="#__codelineno-34-18"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Rolling back from: </span><span class="nv">$BACKUP_DIR</span><span class="s2">&quot;</span>
<a id="__codelineno-34-19" name="__codelineno-34-19" href="#__codelineno-34-19"></a><span class="nb">echo</span>
<a id="__codelineno-34-20" name="__codelineno-34-20" href="#__codelineno-34-20"></a>
<a id="__codelineno-34-21" name="__codelineno-34-21" href="#__codelineno-34-21"></a><span class="c1"># Verify backup exists</span>
<a id="__codelineno-34-22" name="__codelineno-34-22" href="#__codelineno-34-22"></a><span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span>!<span class="w"> </span>-d<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$BACKUP_DIR</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<a id="__codelineno-34-23" name="__codelineno-34-23" href="#__codelineno-34-23"></a><span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot; Backup directory not found: </span><span class="nv">$BACKUP_DIR</span><span class="s2">&quot;</span>
<a id="__codelineno-34-24" name="__codelineno-34-24" href="#__codelineno-34-24"></a><span class="w">    </span><span class="nb">exit</span><span class="w"> </span><span class="m">1</span>
<a id="__codelineno-34-25" name="__codelineno-34-25" href="#__codelineno-34-25"></a><span class="k">fi</span>
<a id="__codelineno-34-26" name="__codelineno-34-26" href="#__codelineno-34-26"></a>
<a id="__codelineno-34-27" name="__codelineno-34-27" href="#__codelineno-34-27"></a><span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span>!<span class="w"> </span>-f<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$BACKUP_DIR</span><span class="s2">/config.yaml.backup&quot;</span><span class="w"> </span><span class="o">]</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="o">[</span><span class="w"> </span>!<span class="w"> </span>-f<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$BACKUP_DIR</span><span class="s2">/nbu_exporter.backup&quot;</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<a id="__codelineno-34-28" name="__codelineno-34-28" href="#__codelineno-34-28"></a><span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot; Backup files not found in </span><span class="nv">$BACKUP_DIR</span><span class="s2">&quot;</span>
<a id="__codelineno-34-29" name="__codelineno-34-29" href="#__codelineno-34-29"></a><span class="w">    </span><span class="nb">exit</span><span class="w"> </span><span class="m">1</span>
<a id="__codelineno-34-30" name="__codelineno-34-30" href="#__codelineno-34-30"></a><span class="k">fi</span>
<a id="__codelineno-34-31" name="__codelineno-34-31" href="#__codelineno-34-31"></a>
<a id="__codelineno-34-32" name="__codelineno-34-32" href="#__codelineno-34-32"></a><span class="c1"># Stop exporter</span>
<a id="__codelineno-34-33" name="__codelineno-34-33" href="#__codelineno-34-33"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Stopping exporter...&quot;</span>
<a id="__codelineno-34-34" name="__codelineno-34-34" href="#__codelineno-34-34"></a><span class="k">if</span><span class="w"> </span>systemctl<span class="w"> </span>is-active<span class="w"> </span>--quiet<span class="w"> </span>nbu_exporter<span class="p">;</span><span class="w"> </span><span class="k">then</span>
<a id="__codelineno-34-35" name="__codelineno-34-35" href="#__codelineno-34-35"></a><span class="w">    </span>sudo<span class="w"> </span>systemctl<span class="w"> </span>stop<span class="w"> </span>nbu_exporter
<a id="__codelineno-34-36" name="__codelineno-34-36" href="#__codelineno-34-36"></a><span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot; Systemd service stopped&quot;</span>
<a id="__codelineno-34-37" name="__codelineno-34-37" href="#__codelineno-34-37"></a><span class="k">elif</span><span class="w"> </span>pgrep<span class="w"> </span>-x<span class="w"> </span>nbu_exporter<span class="w"> </span>&gt;<span class="w"> </span>/dev/null<span class="p">;</span><span class="w"> </span><span class="k">then</span>
<a id="__codelineno-34-38" name="__codelineno-34-38" href="#__codelineno-34-38"></a><span class="w">    </span>pkill<span class="w"> </span>-TERM<span class="w"> </span>nbu_exporter
<a id="__codelineno-34-39" name="__codelineno-34-39" href="#__codelineno-34-39"></a><span class="w">    </span>sleep<span class="w"> </span><span class="m">5</span>
<a id="__codelineno-34-40" name="__codelineno-34-40" href="#__codelineno-34-40"></a><span class="w">    </span>pkill<span class="w"> </span>-9<span class="w"> </span>nbu_exporter<span class="w"> </span><span class="m">2</span>&gt;/dev/null<span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nb">true</span>
<a id="__codelineno-34-41" name="__codelineno-34-41" href="#__codelineno-34-41"></a><span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot; Process stopped&quot;</span>
<a id="__codelineno-34-42" name="__codelineno-34-42" href="#__codelineno-34-42"></a><span class="k">else</span>
<a id="__codelineno-34-43" name="__codelineno-34-43" href="#__codelineno-34-43"></a><span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot; Exporter not running&quot;</span>
<a id="__codelineno-34-44" name="__codelineno-34-44" href="#__codelineno-34-44"></a><span class="k">fi</span>
<a id="__codelineno-34-45" name="__codelineno-34-45" href="#__codelineno-34-45"></a><span class="nb">echo</span>
<a id="__codelineno-34-46" name="__codelineno-34-46" href="#__codelineno-34-46"></a>
<a id="__codelineno-34-47" name="__codelineno-34-47" href="#__codelineno-34-47"></a><span class="c1"># Restore files</span>
<a id="__codelineno-34-48" name="__codelineno-34-48" href="#__codelineno-34-48"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Restoring files...&quot;</span>
<a id="__codelineno-34-49" name="__codelineno-34-49" href="#__codelineno-34-49"></a>cp<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$BACKUP_DIR</span><span class="s2">/config.yaml.backup&quot;</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$CONFIG_FILE</span><span class="s2">&quot;</span>
<a id="__codelineno-34-50" name="__codelineno-34-50" href="#__codelineno-34-50"></a>cp<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$BACKUP_DIR</span><span class="s2">/nbu_exporter.backup&quot;</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$BINARY_PATH</span><span class="s2">&quot;</span>
<a id="__codelineno-34-51" name="__codelineno-34-51" href="#__codelineno-34-51"></a>chmod<span class="w"> </span>+x<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$BINARY_PATH</span><span class="s2">&quot;</span>
<a id="__codelineno-34-52" name="__codelineno-34-52" href="#__codelineno-34-52"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot; Files restored&quot;</span>
<a id="__codelineno-34-53" name="__codelineno-34-53" href="#__codelineno-34-53"></a><span class="nb">echo</span>
<a id="__codelineno-34-54" name="__codelineno-34-54" href="#__codelineno-34-54"></a>
<a id="__codelineno-34-55" name="__codelineno-34-55" href="#__codelineno-34-55"></a><span class="c1"># Start exporter</span>
<a id="__codelineno-34-56" name="__codelineno-34-56" href="#__codelineno-34-56"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Starting exporter...&quot;</span>
<a id="__codelineno-34-57" name="__codelineno-34-57" href="#__codelineno-34-57"></a><span class="k">if</span><span class="w"> </span>systemctl<span class="w"> </span>list-unit-files<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>-q<span class="w"> </span>nbu_exporter.service<span class="p">;</span><span class="w"> </span><span class="k">then</span>
<a id="__codelineno-34-58" name="__codelineno-34-58" href="#__codelineno-34-58"></a><span class="w">    </span>sudo<span class="w"> </span>systemctl<span class="w"> </span>start<span class="w"> </span>nbu_exporter
<a id="__codelineno-34-59" name="__codelineno-34-59" href="#__codelineno-34-59"></a><span class="w">    </span>sleep<span class="w"> </span><span class="m">3</span>
<a id="__codelineno-34-60" name="__codelineno-34-60" href="#__codelineno-34-60"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span>systemctl<span class="w"> </span>is-active<span class="w"> </span>--quiet<span class="w"> </span>nbu_exporter<span class="p">;</span><span class="w"> </span><span class="k">then</span>
<a id="__codelineno-34-61" name="__codelineno-34-61" href="#__codelineno-34-61"></a><span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot; Systemd service started&quot;</span>
<a id="__codelineno-34-62" name="__codelineno-34-62" href="#__codelineno-34-62"></a><span class="w">    </span><span class="k">else</span>
<a id="__codelineno-34-63" name="__codelineno-34-63" href="#__codelineno-34-63"></a><span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot; Failed to start systemd service&quot;</span>
<a id="__codelineno-34-64" name="__codelineno-34-64" href="#__codelineno-34-64"></a><span class="w">        </span><span class="nb">exit</span><span class="w"> </span><span class="m">1</span>
<a id="__codelineno-34-65" name="__codelineno-34-65" href="#__codelineno-34-65"></a><span class="w">    </span><span class="k">fi</span>
<a id="__codelineno-34-66" name="__codelineno-34-66" href="#__codelineno-34-66"></a><span class="k">else</span>
<a id="__codelineno-34-67" name="__codelineno-34-67" href="#__codelineno-34-67"></a><span class="w">    </span>nohup<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$BINARY_PATH</span><span class="s2">&quot;</span><span class="w"> </span>--config<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$CONFIG_FILE</span><span class="s2">&quot;</span><span class="w"> </span>&gt;<span class="w"> </span>/dev/null<span class="w"> </span><span class="m">2</span>&gt;<span class="p">&amp;</span><span class="m">1</span><span class="w"> </span><span class="p">&amp;</span>
<a id="__codelineno-34-68" name="__codelineno-34-68" href="#__codelineno-34-68"></a><span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="nv">$!</span><span class="w"> </span>&gt;<span class="w"> </span>nbu_exporter.pid
<a id="__codelineno-34-69" name="__codelineno-34-69" href="#__codelineno-34-69"></a><span class="w">    </span>sleep<span class="w"> </span><span class="m">3</span>
<a id="__codelineno-34-70" name="__codelineno-34-70" href="#__codelineno-34-70"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span>ps<span class="w"> </span>-p<span class="w"> </span><span class="k">$(</span>cat<span class="w"> </span>nbu_exporter.pid<span class="k">)</span><span class="w"> </span>&gt;<span class="w"> </span>/dev/null<span class="p">;</span><span class="w"> </span><span class="k">then</span>
<a id="__codelineno-34-71" name="__codelineno-34-71" href="#__codelineno-34-71"></a><span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot; Process started&quot;</span>
<a id="__codelineno-34-72" name="__codelineno-34-72" href="#__codelineno-34-72"></a><span class="w">    </span><span class="k">else</span>
<a id="__codelineno-34-73" name="__codelineno-34-73" href="#__codelineno-34-73"></a><span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot; Failed to start process&quot;</span>
<a id="__codelineno-34-74" name="__codelineno-34-74" href="#__codelineno-34-74"></a><span class="w">        </span><span class="nb">exit</span><span class="w"> </span><span class="m">1</span>
<a id="__codelineno-34-75" name="__codelineno-34-75" href="#__codelineno-34-75"></a><span class="w">    </span><span class="k">fi</span>
<a id="__codelineno-34-76" name="__codelineno-34-76" href="#__codelineno-34-76"></a><span class="k">fi</span>
<a id="__codelineno-34-77" name="__codelineno-34-77" href="#__codelineno-34-77"></a><span class="nb">echo</span>
<a id="__codelineno-34-78" name="__codelineno-34-78" href="#__codelineno-34-78"></a>
<a id="__codelineno-34-79" name="__codelineno-34-79" href="#__codelineno-34-79"></a><span class="c1"># Verify rollback</span>
<a id="__codelineno-34-80" name="__codelineno-34-80" href="#__codelineno-34-80"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Verifying rollback...&quot;</span>
<a id="__codelineno-34-81" name="__codelineno-34-81" href="#__codelineno-34-81"></a><span class="k">if</span><span class="w"> </span>curl<span class="w"> </span>-sf<span class="w"> </span>http://localhost:2112/health<span class="w"> </span>&gt;<span class="w"> </span>/dev/null<span class="p">;</span><span class="w"> </span><span class="k">then</span>
<a id="__codelineno-34-82" name="__codelineno-34-82" href="#__codelineno-34-82"></a><span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot; Health check passed&quot;</span>
<a id="__codelineno-34-83" name="__codelineno-34-83" href="#__codelineno-34-83"></a><span class="k">else</span>
<a id="__codelineno-34-84" name="__codelineno-34-84" href="#__codelineno-34-84"></a><span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot; Health check failed&quot;</span>
<a id="__codelineno-34-85" name="__codelineno-34-85" href="#__codelineno-34-85"></a><span class="w">    </span><span class="nb">exit</span><span class="w"> </span><span class="m">1</span>
<a id="__codelineno-34-86" name="__codelineno-34-86" href="#__codelineno-34-86"></a><span class="k">fi</span>
<a id="__codelineno-34-87" name="__codelineno-34-87" href="#__codelineno-34-87"></a>
<a id="__codelineno-34-88" name="__codelineno-34-88" href="#__codelineno-34-88"></a><span class="k">if</span><span class="w"> </span>curl<span class="w"> </span>-s<span class="w"> </span>http://localhost:2112/metrics<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>-q<span class="w"> </span><span class="s2">&quot;^nbu_&quot;</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<a id="__codelineno-34-89" name="__codelineno-34-89" href="#__codelineno-34-89"></a><span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot; Metrics available&quot;</span>
<a id="__codelineno-34-90" name="__codelineno-34-90" href="#__codelineno-34-90"></a><span class="k">else</span>
<a id="__codelineno-34-91" name="__codelineno-34-91" href="#__codelineno-34-91"></a><span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot; Metrics not available&quot;</span>
<a id="__codelineno-34-92" name="__codelineno-34-92" href="#__codelineno-34-92"></a><span class="w">    </span><span class="nb">exit</span><span class="w"> </span><span class="m">1</span>
<a id="__codelineno-34-93" name="__codelineno-34-93" href="#__codelineno-34-93"></a><span class="k">fi</span>
<a id="__codelineno-34-94" name="__codelineno-34-94" href="#__codelineno-34-94"></a>
<a id="__codelineno-34-95" name="__codelineno-34-95" href="#__codelineno-34-95"></a><span class="nb">echo</span>
<a id="__codelineno-34-96" name="__codelineno-34-96" href="#__codelineno-34-96"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;=== Rollback Successful ===&quot;</span>
<a id="__codelineno-34-97" name="__codelineno-34-97" href="#__codelineno-34-97"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Restored from: </span><span class="nv">$BACKUP_DIR</span><span class="s2">&quot;</span>
<a id="__codelineno-34-98" name="__codelineno-34-98" href="#__codelineno-34-98"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Monitor logs: tail -f log/nbu-exporter.log&quot;</span>
</code></pre></div>
<h2 id="summary">Summary</h2>
<p>This document provides comprehensive procedures for:</p>
<ol>
<li><strong>Deployment</strong>: Step-by-step instructions for upgrading to API 10.5 support</li>
<li><strong>Verification</strong>: Multi-level verification from basic health to Grafana dashboards</li>
<li><strong>Backward Compatibility</strong>: Tests to ensure existing configurations work</li>
<li><strong>Rollback</strong>: Quick and detailed rollback procedures</li>
<li><strong>Troubleshooting</strong>: Common issues and solutions</li>
<li><strong>Automation</strong>: Scripts for deployment and rollback</li>
</ol>
<h3 id="key-takeaways">Key Takeaways</h3>
<ul>
<li><strong>No Breaking Changes</strong>: Existing configurations work with default API version</li>
<li><strong>Backward Compatible</strong>: Legacy configs without apiVersion field work correctly</li>
<li><strong>Safe Rollback</strong>: Complete rollback procedures with verification steps</li>
<li><strong>Comprehensive Testing</strong>: Multiple verification levels ensure deployment success</li>
<li><strong>Automated Scripts</strong>: Deployment and rollback scripts for consistency</li>
</ul>
<h3 id="support">Support</h3>
<p>For issues during deployment:</p>
<ol>
<li>Check logs: <code>tail -f log/nbu-exporter.log</code></li>
<li>Review troubleshooting section above</li>
<li>Consult <a href="../api-10.5-migration/">Migration Guide</a></li>
<li>Report issues: <a href="https://github.com/fjacquet/nbu_exporter/issues">https://github.com/fjacquet/nbu_exporter/issues</a></li>
</ol>
<h2 id="related-documentation">Related Documentation</h2>
<ul>
<li><a href="../api-10.5-migration/">API 10.5 Migration Guide</a> - Detailed upgrade instructions</li>
<li><a href="../README.md">README.md</a> - General usage and configuration</li>
<li><a href="../CHANGELOG.md">CHANGELOG.md</a> - Version history and changes</li>
</ul>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "..", "features": ["navigation.sections", "navigation.expand", "navigation.top", "search.highlight", "content.code.copy"], "search": "../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.79ae519e.min.js"></script>
      
    
  </body>
</html>